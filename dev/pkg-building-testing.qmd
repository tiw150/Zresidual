---
title: "Building and Installing Package"
author: "Longhai Li"
format: html
editor_options: 
  chunk_output_type: console
execute: 
  dir: project
---

```{r setup, include=FALSE}
# This forces knitr to use the Project Root directory
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

# Code to Find extdata Directory

```{r}
#| label: setup-extdata-path
#| include: false

# 1. Configuration
pkg_name <- "Zresidual"

# 2. Path Discovery Logic
# Check if we are in the package source (root or vignettes/ directory)
is_source <- file.exists("DESCRIPTION") || file.exists("../DESCRIPTION")
root_dir  <- ifelse(file.exists("DESCRIPTION"), ".", "..")

if (is_source) {
  # Scenario: Local Development or Local pkgdown build
  extdata_path <- file.path(root_dir, "inst", "extdata")
  if (!dir.exists(extdata_path)) dir.create(extdata_path, recursive = TRUE)
  is_dev <- TRUE
} else {
  # Scenario: CRAN or User installation
  extdata_path <- system.file("extdata", package = pkg_name)
  is_dev <- FALSE
}

# 3. Helper: Local Asset Copy
# Ensures knitr can find the file by copying it to the current directory
get_local_asset <- function(filename, source_dir) {
  src <- file.path(source_dir, filename)
  if (!file.exists(src)) return(NULL)
  
  # Copy to current directory if it's not already there
  if (!file.exists(filename) || file.mtime(src) > file.mtime(filename)) {
    file.copy(src, filename, overwrite = TRUE)
  }
  return(filename)
}

# Status for console debugging
message(sprintf("Environment: %s | Path: %s", 
                ifelse(is_dev, "Source", "Installed"), 
                extdata_path))
```

# Install the updated package

```{r, eval=FALSE}
#remove.packages("Zresidual")
devtools::document()

devtools::install(upgrade = "never", build = FALSE, args = c("--no-byte-compile", "--no-test-load"))
suppressWarnings(unloadNamespace("Zresidual"))
library("Zresidual")

```

# Build the package site

## Build the whole Site
```{r}
#devtools::document()
pkgdown::clean_site()
unlink("docs", recursive = TRUE)
# 3. Build fresh
pkgdown::build_site(
    lazy=TRUE,
    preview=TRUE,
    devel=TRUE, 
    install=FALSE)
```


## Build home page only
```{r}
pkgdown::build_home()
```


## Build home page only
```{r}
pkgdown::build_news()
```

## Build an artile

```{r}
pkgdown::build_article("illus_zresid")
```

```{r}
pkgdown::build_article("demo_coxph_survival")
```


```{r}
pkgdown::build_favicons()
```

