<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-22">

<title>Demo of Component-wise Z-residual Diagnosis for Bayesian Hurdle Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="demo_hurdle_brms_files/libs/clipboard/clipboard.min.js"></script>
<script src="demo_hurdle_brms_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="demo_hurdle_brms_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="demo_hurdle_brms_files/libs/quarto-html/popper.min.js"></script>
<script src="demo_hurdle_brms_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="demo_hurdle_brms_files/libs/quarto-html/anchor.min.js"></script>
<link href="demo_hurdle_brms_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="demo_hurdle_brms_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="demo_hurdle_brms_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="demo_hurdle_brms_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="demo_hurdle_brms_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="mystyles.css">
<link rel="stylesheet" href="pkgdown/extra.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Demo of Component-wise Z-residual Diagnosis for Bayesian Hurdle Models</h1>
</div>



<div class="quarto-title-meta column-page">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="installing-zresidual-and-other-packages" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="installing-zresidual-and-other-packages"><span class="header-section-number">1</span> Installing Zresidual and Other packages</h2>
<section id="installing-z-residua-from-the-source" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="installing-z-residua-from-the-source"><span class="header-section-number">1.1</span> Installing Z-residua from the source</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"Zresidual"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"remotes"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"tiw150/Zresidual"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">upgrade =</span> <span class="st">"never"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Zresidual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="intalling-and-loading-r-packages-used-in-this-demo" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="intalling-and-loading-r-packages-used-in-this-demo"><span class="header-section-number">1.2</span> Intalling and Loading R Packages used in this Demo</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector of required packages</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>,<span class="st">"distributions3"</span>,<span class="st">"foreach"</span>, <span class="st">"statip"</span>, <span class="st">"VGAM"</span>, <span class="st">"plotrix"</span>, <span class="st">"actuar"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"stringr"</span>, <span class="st">"Rlab"</span>, <span class="st">"dplyr"</span>, <span class="st">"rlang"</span>, <span class="st">"tidyr"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"matrixStats"</span>, <span class="st">"timeDate"</span>, <span class="st">"katex"</span>, <span class="st">"gt"</span>,<span class="st">"loo"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>missing_pkgs <span class="ot">&lt;-</span> pkgs[<span class="sc">!</span><span class="fu">vapply</span>(pkgs, requireNamespace, <span class="fu">logical</span>(<span class="dv">1</span>), <span class="at">quietly =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_pkgs)) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Installing missing packages: "</span>, <span class="fu">paste</span>(missing_pkgs, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(missing_pkgs, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(pkgs, <span class="cf">function</span>(p) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(p, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(nc) <span class="sc">&amp;&amp;</span> nc <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="fu">options</span>(<span class="at">mc.cores =</span> nc <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>This vignette demonstrates how to use the <code>Zresidual</code> package to compute component-wise Z-residuals for diagnosing Bayesian hurdle models <span class="citation" data-cites="Mullahy1986-em">(<a href="#ref-Mullahy1986-em" role="doc-biblioref">Mullahy 1986</a>)</span>, based on the output from the <code>brms</code> package in R <span class="citation" data-cites="Burkner2017-brms">(<a href="#ref-Burkner2017-brms" role="doc-biblioref">Bürkner 2017</a>)</span> can be calculated separately for the zero, count and hurdle components to reveal potential model misspecifications. The examples illustrate the practical use of these residuals for <abbr title="Randomized Predictive P-value">RPP</abbr> <span class="citation" data-cites="Feng2020">(<a href="#ref-Feng2020" role="doc-biblioref">Feng, Li, and Sadeghpour 2020</a>)</span> diagnostics.</p>
</section>
<section id="definitions-of-component-wise-z-residuals-for-bayesian-hurdle-models" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="definitions-of-component-wise-z-residuals-for-bayesian-hurdle-models"><span class="header-section-number">3</span> Definitions of Component-wise Z-residuals for Bayesian Hurdle Models</h2>
This section demonstrates the definiotns of component-wise posterior predictive quantities including the posterior predictive <abbr title="Probability Mass Function">PMF</abbr>, survival function, and <abbr title="Randomized Predictive P-value">RPP</abbr> for Bayesian hurdle models. Hurdle models consist of two parts:
<ul>
<li>
A <strong>logistic component</strong> modeling the probability of structural zeros.
</li>
<li>
A <strong>count component</strong> modeling positive counts using a zero-truncated distribution.
</li>
</ul>
<p>Let <span class="math inline">\(C_i \in \{0, 1\}\)</span>, where <span class="math inline">\(C_i = 1\)</span> indicates a non-zero value, and <span class="math inline">\(C_i = 0\)</span> indicates a zero value for the <span class="math inline">\(i^\th\)</span> observations. If <span class="math inline">\(C_i=1\)</span>, the corresponding count model then operates on <span class="math inline">\(y_i^+ \in \{1, 2, \dots\}\)</span>, i.e., the positive counts only.</p>
Using Bayesian estimation (e.g., via the <code>brms</code> package), we draw <span class="math inline">\(T\)</span> samples from the posterior distribution. Let <span class="math inline">\(\theta^{(t)}\)</span> denote the <span class="math inline">\(t^\th\)</span> posterior draw, including component-specific parameters like:
<ul>
<li>
<span class="math inline">\(\pi^o_i\)</span> : the zero porbability,
</li>
<li>
<span class="math inline">\(\mu_i^{(t)}, \phi^{(t)}\)</span> : parameters for the count component.
</li>
</ul>
<p>For a given observation <span class="math inline">\(y_i^\text{obs}\)</span>, the component-wise posterior predictive <abbr title="Probability Mass Function">PMF</abbr> and survival functions are defined below.</p>
<section id="hurdle-model" class="level4" data-number="3.0.1">
<h4 data-number="3.0.1" class="anchored" data-anchor-id="hurdle-model"><span class="header-section-number">3.0.1</span> <strong>Hurdle Model:</strong></h4>
<p><span class="math display">\[\begin{equation}
p_i^{\text{post}, \pi^o_irdle}(y_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
{\pi^o_i}^{(t)} &amp; \text{if } y_i^\text{obs} = 0, \\
(1 - {\pi^o_i}^{(t)}) \cdot\frac{p_i^\text{UT}(y_i^\text{obs} | \theta^{(t)})}{1 - p_i^\text{UT}(0 | \theta^{(t)})} &amp; \text{if } y_i^\text{obs} =1, 2, \ldots,\\
0 &amp; \text{otherwise.}
\end{cases}  
\end{equation}\]</span> <span class="math display">\[\begin{equation}
S_i^{\text{post}, \pi^o_irdle}(y_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
1 &amp; \text{if } y_i^\text{obs} &lt; 0, \\
1-{\pi^o_i}^{(t)} &amp; \text{if } 0 \le y_i^\text{obs} &lt; 1, \\
(1 - {\pi^o_i}^{(t)}) \cdot \frac{S_i^\text{UT}(y_i^\text{obs} \mid \theta^{(t)})}{1-p_i^\text{UT}(0 \mid \theta^{(t)})} &amp; \text{if } y_i^\text{obs} \ge 1.
\end{cases}
\end{equation}\]</span></p>
</section>
<section id="logistic-component" class="level4" data-number="3.0.2">
<h4 data-number="3.0.2" class="anchored" data-anchor-id="logistic-component"><span class="header-section-number">3.0.2</span> <strong>Logistic Component:</strong></h4>
<p><span class="math display">\[\begin{equation}
\label{componentwise_logistic_pmf}
p_i^{\text{post}, \text{logit}}(c_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
{\pi^o_i}^{(t)} &amp; \text{if } c_i^\text{obs} = 0, \\
1 - {\pi^o_i}^{(t)} &amp; \text{if } c_i^\text{obs} = 1,\\
0 &amp; \text{otherwise.}
\end{cases}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\label{componentwise_logistic_survival}
S_i^{\text{post}, \text{logit}}(c_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
1 &amp; \text{if } c_i^\text{obs} &lt; 0, \\
1-{\pi^o_i}^{(t)} &amp; \text{if } 0 \le c_i^\text{obs} &lt; 1, \\
0, &amp; \text{if } c_i^\text{obs} \ge 1.
\end{cases}
\end{equation}\]</span></p>
</section>
<section id="count-compoenent" class="level4" data-number="3.0.3">
<h4 data-number="3.0.3" class="anchored" data-anchor-id="count-compoenent"><span class="header-section-number">3.0.3</span> <strong>Count Compoenent:</strong></h4>
<p><span class="math display">\[\begin{equation}
\label{componentwise_count_pmf}
p_i^{\text{post},\text{count}}({y_i^+}^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
    \frac{p_i^\text{UT}({y_i^+}^\text{obs} \mid \theta^{(t)})}{1 - p_i^\text{UT}(0 \mid \theta^{(t)})}, &amp; \text{ for } {y_i^{+}}^\text{obs} = 1,2,\ldots,\\
    0 &amp; \text{ otherwise.}
\end{cases}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\label{componentwise_count_survival}
S_i^{\text{post}, \text{count}}({y_i^+}^\text{obs}) = \frac{1}{T} \sum_{t=1}^T
\begin{cases}
    1 &amp; \text{ if } {y_i^+}^\text{obs} &lt; 1 \\
    \frac{S_i^\text{UT}({y_i^+}^\text{obs} \mid \theta^{(t)})}{1-p_i^\text{UT}(0 \mid \theta^{(t)})}, &amp; \text{ if } {y_i^+}^\text{obs} \ge 1
\end{cases}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(p_i^\text{UT}(. \mid \theta^{(t)})\)</span> and <span class="math inline">\(S_i^\text{UT}(. \mid \theta^{(t)})\)</span> denote the <abbr title="Probability Mass Function">PMF</abbr> and survival function of the untruncated count distribution, given the component-specific posterior parameters <span class="math inline">\(\theta^{(t)}\)</span>.</p>
<p>For any observed value <span class="math inline">\(y_i^\text{obs}\)</span>, we define: <span class="math display">\[\begin{equation}
\label{eq:post_rpp}\text{rpp}_i(y_i^\text{obs} | \theta^{(t)}) = S_i(y_i^\text{obs} | \theta^{(t)}) + U_i \times p_i(y_i^\text{obs} | \theta^{(t)})
\end{equation}\]</span> where <span class="math inline">\(U_i \sim \text{Uniform}(0,1)\)</span>. Here, <span class="math inline">\(y_i^\text{obs}\)</span> is the observed value, which can refer to either the binary response <span class="math inline">\(C_i\)</span> or the positive count <span class="math inline">\({y_i^+}^\text{obs}\)</span>, depending on the component being evaluated. Then, the Z-residual of a discrete response variable is, <span class="math display">\[\begin{equation}
\label{eq:z_residual}
z_i = -\Phi^{-1}(\text{rpp}_i(y_i^\text{obs}|\theta)) \sim N(0, 1)
\end{equation}\]</span> where (^{-1}(.)) is the quantile function of standard normal distribution.</p>
</section>
</section>
<section id="a-simulation-example" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="a-simulation-example"><span class="header-section-number">4</span> A Simulation Example</h2>
<section id="model-fitting-with-brms" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="model-fitting-with-brms"><span class="header-section-number">4.1</span> Model fitting with <code>brms</code></h3>
<p>To demonstrate how <code>Zresidual</code> works with hurdle models, we first simulate data from a <abbr title="Hurdle Negative Binomial">HNB</abbr> model. This simulated dataset allows us to evaluate how well the model and residual diagnostics perform when the true data-generating process is known.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span>   <span class="co"># Intercept for hurdle (zero) part</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span>  <span class="co"># Coefficient for hurdle part</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>alpha0 <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># Intercept for count part</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="dv">6</span>  <span class="co"># Coefficient for count part</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">6</span>      <span class="co"># Dispersion parameter for negative binomial</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n) <span class="co"># Predictor</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Hurdle (zero) part</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>logit_p <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>p_zero <span class="ot">&lt;-</span> <span class="fu">exp</span>(logit_p) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(logit_p))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>zeros <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p_zero)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Count (non-zero) part</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>log_mu <span class="ot">&lt;-</span> alpha0 <span class="sc">+</span> alpha1 <span class="sc">*</span> x</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_mu)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate from zero-truncated negative binomial</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> size <span class="sc">/</span> (size <span class="sc">+</span> mu)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>zeros)<span class="sc">*</span>distributions3<span class="sc">::</span><span class="fu">rztnbinom</span>(n, size, prob)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># A random error variable</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Final dataset</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x, <span class="at">z =</span> z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This dataset includes a single continuous predictor <code>x</code>, a rando error variable <code>z</code> and the outcome <code>y</code> is generated from a hurdle negative binomial process. Note that the error variable is not included in generating the <code>y</code> outcome variable. The hurdle (zero) part is modeled with a logistic function and the count part uses a zero-truncated negative binomial distribution.</p>
<p>Now, we use the <code>brms</code> package to fit a hurdle negative binomial model to the simulated data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(distributions3)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"inst/extdata/fit_hnb.Rdata"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#fit_hnb &lt;- brm(bf(y ~ x + z, hu ~ x + z),</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#               data = sim_data, </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#               family = hurdle_negbinomial())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>hu</code> formula models the hurdle (zero) part, while the main formula models the count component. The <code>family = hurdle_negbinomial()</code> tells <code>brms</code> to use a hurdle model with a negative binomial distribution for the non-zero counts. We use default parameter setting on this example to fit the model.</p>
</section>
<section id="computing-z-residuals" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="computing-z-residuals"><span class="header-section-number">4.2</span> Computing Z-residuals</h3>
<p>In this example, we compute Z-residuals for the <abbr title="Hurdle Negative Binomial">HNB</abbr> model separately for, logistic component (zero part) and count component using <code>Zresidual()</code>. Apart from component-wise Z-residuals, the <code>Zresidual</code> package support overall model Z-residual calculation. The package take <code>brms</code> fit as an input and the <code>type</code> argument (<code>"zero", "count" or "hurdle"</code>) specifies which component to use when calculating the residuals. By default, Z-residuals are computed using the Importance Sampling Cross-Validation (<code>iscv</code>) method based on randomized predictive p-values (<abbr title="Randomized Predictive P-value">RPP</abbr>). Alternatively, users can choose the standard Posterior <abbr title="Randomized Predictive P-value">RPP</abbr> method by setting <code>method = "post"</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(matrixStats)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(distributions3)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Zresidual)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>zres_hnb_post_zero <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hnb, <span class="at">type =</span> <span class="st">"zero"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>zres_hnb_post_count <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hnb, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>zres_hnb_post_hurdle <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hnb, <span class="at">type =</span> <span class="st">"hurdle"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="what-the-function-returns" class="level5" data-number="4.2.0.1">
<h5 data-number="4.2.0.1" class="anchored" data-anchor-id="what-the-function-returns"><span class="header-section-number">4.2.0.1</span> <strong>What the function returns</strong></h5>
<p>The function <code>Zresidual.hurdle.negbinomial()</code> (and other Z-residual computing functions) returns a matrix of Z-residuals, with additional attributes. The returned object is of class <code>zresid</code>, which includes metadata useful for diagnostic and plotting purposes.</p>
<p><strong>Return Value</strong></p>
<p>A numeric matrix of dimension <code>n × nrep</code>, where <code>n</code> is the number of observations in the data and <code>nrep</code> is the number of randomized replicates of Z-residuals (default is 1). Each column represents a set of Z-residuals computed from a <abbr title="Randomized Predictive P-value">RPP</abbr>, using either posterior (<code>post</code>) or importance sampling cross-validation (<code>iscv</code>) log predictive distributions.</p>
<p><strong>Matrix Attributes</strong></p>
The returned matrix includes the following attached attributes:
<ul>
<li>
<code>type</code>: The component of the hurdle model the residuals correspond to. One of “zero”, “count”, or “hurdle”.
</li>
<li>
<code>zero_id</code>: Indices of observations where the response value was 0. Useful for separating diagnostics by zero and non-zero parts.
</li>
<li>
<code>log_pmf</code>: A matrix of log predictive probabilities (log-<abbr title="Probability Mass Function">PMF</abbr>) per observation and posterior draw.
</li>
<li>
<code>log_cdf</code>: A matrix of log predictive CDF values used in computing the <abbr title="Randomized Predictive P-value">RPP</abbr>s.
</li>
<li>
<code>covariates</code>: A data frame containing the covariates used in the model (excluding the response variable). This can be used for plotting or conditional diagnostics.
</li>
<li>
<code>fitted.value</code>: The posterior mean predicted value for each observation depending on the type.
</li>
</ul></section>
</section>
<section id="diagnostic-tools-for-z-residuals" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="diagnostic-tools-for-z-residuals"><span class="header-section-number">4.3</span> Diagnostic Tools for Z-Residuals</h3>
<section id="visualizing-z-residuals" class="level5" data-number="4.3.0.1">
<h5 data-number="4.3.0.1" class="anchored" data-anchor-id="visualizing-z-residuals"><span class="header-section-number">4.3.0.1</span> Visualizing Z-residuals</h5>
The <code>Zresidual</code> package includes built-in plotting functions (QQ Plot, Scatter Plot, Boxplot) to help diagnose model fit using Z-residuals. These functions are designed to work directly with objects of class <code>zresid</code> returned by functions like <code>Zresidual()</code>. These plots help assess:
<ul>
<li>
Whether residuals are approximately standard normal (via QQ plots),
</li>
<li>
Whether there are patterns in residuals across fitted values (which may suggest model misspecification),
</li>
<li>
Whether residuals differ across covariates (optional extensions).
</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hnb_post_zero,<span class="at">irep=</span>i)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hnb_post_count,<span class="at">irep=</span>i)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hnb_post_hurdle,<span class="at">irep=</span>i)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/qqplot-zresid-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 1: QQ plots</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hnb_post_zero, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>,<span class="at">irep=</span>i)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hnb_post_count, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>, <span class="at">log =</span> <span class="st">"x"</span>,<span class="at">irep=</span>i)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hnb_post_hurdle, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>, <span class="at">log =</span> <span class="st">"x"</span>,<span class="at">irep=</span>i)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/plot-zresid-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 2: Scatter plots</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hnb_post_zero, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hnb_post_count, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hnb_post_hurdle, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/boxplot-zresid-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 3: boxplots</figcaption>
</figure>
</div>
</div>
</div>
<p>The diagnostic evaluations for the true model—comprising scatter plots, Q-Q plots, and boxplots of Z-residuals—demonstrate that the model adequately captures the data structure. Across the logistic, count, and hurdle components, Z-residuals are evenly scattered around zero and mostly fall within the range of -3 to 3, indicating no visible model misfit. Complementary statistical tests, including the <abbr title="Shapiro-Wilk">SW</abbr> test for normality, <abbr title="Analysis of Variance">ANOVA</abbr> for mean equality, and <abbr title="Bartlett's">BL</abbr> test for variance homogeneity, all return p-values above the 0.05 threshold. This suggests that the residuals follow a normal distribution and exhibit equal means and variances across fitted value intervals. The Q-Q plots further support normality through close alignment with the 45-degree reference line, while the boxplots confirm consistent residual means across partitions. Collectively, these diagnostics validate that the true model satisfies key distributional assumptions and that the proposed Z-residual methods are effective in detecting model adequacy.</p>
<p>The plotting functions in the Zresidual package are designed to be flexible and lightweight, allowing users to quickly visualize residual patterns across different components of hurdle models. These functions support all customizable arguments in base <code>R</code> functions such as axes, labels etc. by making them adaptable to a wide range of diagnostic workflows. The <code>plot.zresid()</code> function offers flexible diagnostic plotting for Z-residuals, supporting various x-axes such as index, fitted values, and covariates. Both <code>plot.zresid()</code> and <code>qqnorm.zresid()</code> automatically highlights outlier residuals that fall outside the typical (or user specified)range making it easier to identify problematic observations.</p>
</section>
<section id="statistical-tests" class="level5" data-number="4.3.0.2">
<h5 data-number="4.3.0.2" class="anchored" data-anchor-id="statistical-tests"><span class="header-section-number">4.3.0.2</span> Statistical Tests</h5>
<p>In addition to visual diagnostics, the package offers formal statistical tests to quantify deviations from normality or homogeneity of variance in Z-residuals by taking an <code>zresid</code> class object as an input.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>zero_sw <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sw.test.zresid</span>(zres_hnb_post_zero))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>count_sw <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sw.test.zresid</span>(zres_hnb_post_count))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>hurdle_sw <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sw.test.zresid</span>(zres_hnb_post_hurdle))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>zero_aov <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">aov.test.zresid</span>(zres_hnb_post_zero))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>count_aov <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">aov.test.zresid</span>(zres_hnb_post_count))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>hurdle_aov <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">aov.test.zresid</span>(zres_hnb_post_hurdle))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>zero_bl <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">bartlett.test.zresid</span>(zres_hnb_post_zero))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>count_bl <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">bartlett.test.zresid</span>(zres_hnb_post_count))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>hurdle_bl <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">bartlett.test.zresid</span>(zres_hnb_post_hurdle))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>gof_wide <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Residual =</span> <span class="fu">paste0</span>(<span class="st">"CV.Z-residual "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">SW_Zero =</span> zero_sw, <span class="at">SW_Count =</span> count_sw, <span class="at">SW_Hurdle =</span> hurdle_sw,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">AOV_Zero =</span> zero_aov, <span class="at">AOV_Count =</span> count_aov, <span class="at">AOV_Hurdle =</span> hurdle_aov,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">BL_Zero =</span> zero_bl, <span class="at">BL_Count =</span> count_bl, <span class="at">BL_Hurdle =</span> hurdle_bl</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>gof_table <span class="ot">&lt;-</span> gof_wide <span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">"Shapiro-Wilk"</span>, <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"SW_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">"ANOVA"</span>, <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"AOV_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">"Bartlett"</span>, <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"BL_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SW_Zero =</span> <span class="st">"Zero"</span>, <span class="at">SW_Count =</span> <span class="st">"Count"</span>, <span class="at">SW_Hurdle =</span> <span class="st">"Hurdle"</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">AOV_Zero =</span> <span class="st">"Zero"</span>, <span class="at">AOV_Count =</span> <span class="st">"Count"</span>, <span class="at">AOV_Hurdle =</span> <span class="st">"Hurdle"</span>,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">BL_Zero =</span> <span class="st">"Zero"</span>, <span class="at">BL_Count =</span> <span class="st">"Count"</span>, <span class="at">BL_Hurdle =</span> <span class="st">"Hurdle"</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="sc">-</span>Residual, <span class="at">decimals =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.font.weight =</span> <span class="st">"bold"</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">100</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">12</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"#f9f9f9"</span>),</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"AOV_"</span>))</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>gof_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="prhhscbign" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#prhhscbign table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#prhhscbign thead, #prhhscbign tbody, #prhhscbign tfoot, #prhhscbign tr, #prhhscbign td, #prhhscbign th {
  border-style: none;
}

#prhhscbign p {
  margin: 0;
  padding: 0;
}

#prhhscbign .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#prhhscbign .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#prhhscbign .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#prhhscbign .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#prhhscbign .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#prhhscbign .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#prhhscbign .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#prhhscbign .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#prhhscbign .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#prhhscbign .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#prhhscbign .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#prhhscbign .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#prhhscbign .gt_spanner_row {
  border-bottom-style: hidden;
}

#prhhscbign .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#prhhscbign .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#prhhscbign .gt_from_md > :first-child {
  margin-top: 0;
}

#prhhscbign .gt_from_md > :last-child {
  margin-bottom: 0;
}

#prhhscbign .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#prhhscbign .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#prhhscbign .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#prhhscbign .gt_row_group_first td {
  border-top-width: 2px;
}

#prhhscbign .gt_row_group_first th {
  border-top-width: 2px;
}

#prhhscbign .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#prhhscbign .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#prhhscbign .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#prhhscbign .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#prhhscbign .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#prhhscbign .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#prhhscbign .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#prhhscbign .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#prhhscbign .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#prhhscbign .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#prhhscbign .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#prhhscbign .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#prhhscbign .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#prhhscbign .gt_left {
  text-align: left;
}

#prhhscbign .gt_center {
  text-align: center;
}

#prhhscbign .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#prhhscbign .gt_font_normal {
  font-weight: normal;
}

#prhhscbign .gt_font_bold {
  font-weight: bold;
}

#prhhscbign .gt_font_italic {
  font-style: italic;
}

#prhhscbign .gt_super {
  font-size: 65%;
}

#prhhscbign .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#prhhscbign .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#prhhscbign .gt_indent_1 {
  text-indent: 5px;
}

#prhhscbign .gt_indent_2 {
  text-indent: 10px;
}

#prhhscbign .gt_indent_3 {
  text-indent: 15px;
}

#prhhscbign .gt_indent_4 {
  text-indent: 20px;
}

#prhhscbign .gt_indent_5 {
  text-indent: 25px;
}

#prhhscbign .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#prhhscbign div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="Residual" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Residual</th>
<th colspan="3" id="Shapiro-Wilk" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Shapiro-Wilk
</div></th>
<th colspan="3" id="ANOVA" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
ANOVA
</div></th>
<th colspan="3" id="Bartlett" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Bartlett
</div></th>
</tr>
<tr class="gt_col_headings even">
<th id="SW_Zero" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Zero</th>
<th id="SW_Count" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Count</th>
<th id="SW_Hurdle" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Hurdle</th>
<th id="AOV_Zero" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Zero</th>
<th id="AOV_Count" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Count</th>
<th id="AOV_Hurdle" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Hurdle</th>
<th id="BL_Zero" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Zero</th>
<th id="BL_Count" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Count</th>
<th id="BL_Hurdle" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Hurdle</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 1</td>
<td class="gt_row gt_center" headers="SW_Zero">0.8526</td>
<td class="gt_row gt_center" headers="SW_Count">0.2959</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.3817</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.2418</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.3392</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.3601</td>
<td class="gt_row gt_center" headers="BL_Zero">0.9600</td>
<td class="gt_row gt_center" headers="BL_Count">0.2487</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.7742</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 2</td>
<td class="gt_row gt_center" headers="SW_Zero">0.5129</td>
<td class="gt_row gt_center" headers="SW_Count">0.1464</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.1786</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.4366</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.3868</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.5201</td>
<td class="gt_row gt_center" headers="BL_Zero">0.5550</td>
<td class="gt_row gt_center" headers="BL_Count">0.9182</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9738</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 3</td>
<td class="gt_row gt_center" headers="SW_Zero">0.9383</td>
<td class="gt_row gt_center" headers="SW_Count">0.0967</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.3137</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.1949</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.4311</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.6813</td>
<td class="gt_row gt_center" headers="BL_Zero">0.9810</td>
<td class="gt_row gt_center" headers="BL_Count">0.9878</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.5012</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 4</td>
<td class="gt_row gt_center" headers="SW_Zero">0.1859</td>
<td class="gt_row gt_center" headers="SW_Count">0.1783</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.3006</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.7989</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.4105</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.6040</td>
<td class="gt_row gt_center" headers="BL_Zero">0.9135</td>
<td class="gt_row gt_center" headers="BL_Count">0.8731</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9530</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 5</td>
<td class="gt_row gt_center" headers="SW_Zero">0.1063</td>
<td class="gt_row gt_center" headers="SW_Count">0.7936</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.0567</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.5454</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.4989</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.2125</td>
<td class="gt_row gt_center" headers="BL_Zero">0.1450</td>
<td class="gt_row gt_center" headers="BL_Count">0.7718</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.8758</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 6</td>
<td class="gt_row gt_center" headers="SW_Zero">0.5778</td>
<td class="gt_row gt_center" headers="SW_Count">0.4390</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.2494</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.7863</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.2481</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.8334</td>
<td class="gt_row gt_center" headers="BL_Zero">0.3943</td>
<td class="gt_row gt_center" headers="BL_Count">0.8871</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9009</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 7</td>
<td class="gt_row gt_center" headers="SW_Zero">0.2347</td>
<td class="gt_row gt_center" headers="SW_Count">0.0686</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.4560</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.9784</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.4299</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.6919</td>
<td class="gt_row gt_center" headers="BL_Zero">0.1519</td>
<td class="gt_row gt_center" headers="BL_Count">0.9892</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9402</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 8</td>
<td class="gt_row gt_center" headers="SW_Zero">0.4265</td>
<td class="gt_row gt_center" headers="SW_Count">0.5480</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.0115</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.3470</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.3494</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.4917</td>
<td class="gt_row gt_center" headers="BL_Zero">0.3692</td>
<td class="gt_row gt_center" headers="BL_Count">0.9060</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.5222</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 9</td>
<td class="gt_row gt_center" headers="SW_Zero">0.9005</td>
<td class="gt_row gt_center" headers="SW_Count">0.1203</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.0341</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.6767</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.4791</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.6111</td>
<td class="gt_row gt_center" headers="BL_Zero">0.3525</td>
<td class="gt_row gt_center" headers="BL_Count">0.9814</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9345</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Residual">CV.Z-residual 10</td>
<td class="gt_row gt_center" headers="SW_Zero">0.6477</td>
<td class="gt_row gt_center" headers="SW_Count">0.5330</td>
<td class="gt_row gt_center" headers="SW_Hurdle">0.1321</td>
<td class="gt_row gt_center" headers="AOV_Zero" style="background-color: #F9F9F9">0.7261</td>
<td class="gt_row gt_center" headers="AOV_Count" style="background-color: #F9F9F9">0.3711</td>
<td class="gt_row gt_center" headers="AOV_Hurdle" style="background-color: #F9F9F9">0.5655</td>
<td class="gt_row gt_center" headers="BL_Zero">0.1476</td>
<td class="gt_row gt_center" headers="BL_Count">0.9521</td>
<td class="gt_row gt_center" headers="BL_Hurdle">0.9065</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These tests return standard <code>htest</code> or <code>aov</code> objects, making them easy to report, summarize, or integrate into automated workflows. One advantage of the visualization functions provided by the <code>Zresidual</code> package is that they allow users to diagnose the model both visually and using statistical tests simultaneously.</p>
<p>We might be also interested in comparing our <abbr title="Hurdle Negative Binomial">HNB</abbr> model to <abbr title="Hurdle Poisson">HP</abbr> model taking the <abbr title="Hurdle Poisson">HP</abbr> model as misspecified model .</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"inst/extdata/fit_hp.Rdata"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#fit_hp &lt;- brm(bf(y ~ x + z, hu ~ x + z),</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#               data = sim_data, </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#               family = hurdle_negbinomial(),</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#               prior = prior("normal(1000, 1)", class = "shape"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This <code>prior("normal(1000, 1)", class = "shape")</code> is a very strong prior, tightly centered around 1000. Its practical effect is to force the shape parameter to be very large, which in turn makes the model behave almost like a Poisson distribution for the positive counts (truncated part of the hurdle model).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>zres_hp_post_zero <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hp, <span class="at">type =</span> <span class="st">"zero"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>zres_hp_post_count <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hp, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>zres_hp_post_hurdle <span class="ot">&lt;-</span> <span class="fu">Zresidual</span>(fit_hp, <span class="at">type =</span> <span class="st">"hurdle"</span>, <span class="at">method =</span> <span class="st">"rpost"</span>,<span class="at">nrep=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hp_post_zero,<span class="at">irep=</span>i)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hp_post_count,<span class="at">irep=</span>i)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm.zresid</span>(zres_hp_post_hurdle,<span class="at">irep=</span>i)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/QQ-zresid2-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 4: qqplots</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hp_post_zero, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>,<span class="at">irep=</span>i)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hp_post_count, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>, <span class="at">log =</span> <span class="st">"x"</span>,<span class="at">irep=</span>i)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.zresid</span>(zres_hp_post_hurdle, <span class="at">x_axis_var=</span><span class="st">"lp"</span>, <span class="at">outlier.return =</span> <span class="cn">TRUE</span>, <span class="at">log =</span> <span class="st">"x"</span>,<span class="at">irep=</span>i)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/plot-zresid2-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 5: plots</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hp_post_zero, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hp_post_count, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(zres_hp_post_hurdle, <span class="at">x_axis_var=</span><span class="st">"lp"</span>,<span class="at">irep=</span>i)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_hurdle_brms_files/figure-html/boxplot-zresid2-.gif" class="img-fluid figure-img" width="960"></p>
<figcaption>Figure 6: qqplots</figcaption>
</figure>
</div>
</div>
</div>
<p>While the logistic component shows randomly scattered residuals and normal Q-Q alignment, supported by non-significant p-values, the count and hurdle components display clear signs of misspecification. These include banded residual patterns, heavy tails, Q-Q deviations, and significant p-values from the <abbr title="Shapiro-Wilk">SW</abbr>, <abbr title="Analysis of Variance">ANOVA</abbr>, and <abbr title="Bartlett's">BL</abbr> tests. The overall hurdle model diagnostics reflect similar issues but cannot isolate the source of misfit. This highlights a key advantage of component-wise residual analysis: it reveals that the logistic sub-model is correctly specified, while the count component is not. Such separation enables more precise identification and correction of modeling issues.</p>
<p>##Real Data Example for Illustration and Demonstration</p>
</section>
</section>
</section>
<section id="other-functions" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="other-functions"><span class="header-section-number">5</span> Other Functions</h2>
<p>In addition to Z-residual computation and visualization, the <code>Zresidual</code> package provides several utility functions to support deeper model diagnostics and probabilistic analysis including functions for calculating the logarithmic predictive p-values (<code>post_logrpp()</code>, <code>iscv_logrpp()</code>). The package also includes dedicated functions to compute the logarithmic PDFs and CDFs for supported distributions. These can be used to manually inspect likelihood components or to derive custom model evaluation metrics. The log-scale calculations offer improved numerical stability, especially when dealing with small probabilities. These tools integrate seamlessly with outputs from Bayesian models fitted using <code>brms</code>, maintaining compatibility and flexibility. Together, they extend the package’s functionality beyond residual analysis, supporting a comprehensive and rigorous approach to Bayesian model checking.</p>
</section>
<section id="references" class="level2 unnumbered" data-number="6">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">6 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Burkner2017-brms" class="csl-entry" role="listitem">
Bürkner, Paul-Christian. 2017. <span>“<span class="nocase">brms</span>: An <span>R</span> Package for <span>Bayesian</span> Multilevel Models Using <span>Stan</span>.”</span> <em>Journal of Statistical Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-Feng2020" class="csl-entry" role="listitem">
Feng, Cindy, Longhai Li, and Alireza Sadeghpour. 2020. <span>“A Comparison of Residual Diagnosis Tools for Diagnosing Regression Models for Count Data.”</span> <em>BMC Medical Research Methodology</em> 20 (1): 175. <a href="https://doi.org/10.1186/s12874-020-01055-2">https://doi.org/10.1186/s12874-020-01055-2</a>.
</div>
<div id="ref-Mullahy1986-em" class="csl-entry" role="listitem">
Mullahy, John. 1986. <span>“Specification and Testing of Some Modified Count Data Models.”</span> <em>J. Econom.</em> 33 (3): 341–65.
</div>
</div></section></div></main>
<!-- /main column -->
<script>
/* loadtoc.js — overlay TOC drawer (no layout shift, up to h3)
   - Creates a fixed-position overlay panel + backdrop
   - Clones existing Quarto TOC if found; else builds from <main> h2/h3
   - Collapses h3 under h2 initially; click to toggle
   - Closes on link click, backdrop click, or ESC
   - Prevents body scroll when open; does NOT push page content
*/

(() => {
  // ===== Config =====
  const CFG = {
    side: 'right',            // 'right' | 'left'
    fontSize: '14px',
    width: 400,               // px
    maxWidthVw: 92,           // %
    headerOffset: 80,         // px: scroll margin for headings
    zBase: 2000,              // base z-index for overlay/backdrop
    buildFromHeadingsIfMissingSidebar: true, // fallback builder
    headingSelector: 'main :is(h2,h3)',      // used if building fallback
    maxDepth: 3,              // up to h3
    toggleHotkey: 'KeyT',     // Cmd/Ctrl+Shift+T toggles
  };

  // ===== Utilities =====
  const $ = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];
  const on = (el, ev, fn, opts) => el && el.addEventListener(ev, fn, opts);

  const slugify = (txt) =>
    txt.toLowerCase()
       .trim()
       .replace(/[\s\.\,\/:\;\?\!\(\)\[\]\{\}"'`]+/g, '-')
       .replace(/-+/g, '-')
       .replace(/^-|-$/g, '');

  function ensureId(el) {
    if (!el.id) el.id = slugify(el.textContent || 'section');
    return el.id;
  }

  function injectStyles() {
    const style = document.createElement('style');
    style.setAttribute('data-toc-style', 'overlay');
    style.textContent = `
      :root { 
        --toc-width:${CFG.width}px; 
        --toc-offset:${CFG.headerOffset}px; 
        --toc-z:${CFG.zBase}; 
        --toc-font-size:${CFG.fontSize};
      }
      main :is(h1,h2,h3,h4,h5,h6){ scroll-margin-top: var(--toc-offset); }

      #toc-toggle-btn {
        position: fixed; top: 50px; ${CFG.side}: 10px;
        z-index: calc(var(--toc-z) + 2);
        padding: 0.1rem 0.6rem; border: 1px solid #ddd; border-radius: 999px;
        background: #fff; cursor: pointer; box-shadow: 0 8px 24px rgba(0,0,0,.10);
        font: 1000 32px system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      }

      #toc-backdrop {
        position: fixed; inset: 0; background: rgba(0,0,0,.25);
        opacity: 0; pointer-events: none; transition: opacity .2s ease;
        z-index: var(--toc-z);
      }
      body.toc-open #toc-backdrop { opacity: 1; pointer-events: auto; }

      #toc-panel {
        position: fixed; top: 0; ${CFG.side}: 0; height: 100vh;
        width: var(--toc-width); max-width: ${CFG.maxWidthVw}vw;
        background: #fff; box-shadow: ${CFG.side==='right' ? '-16px' : '16px'} 0 32px rgba(0,0,0,.08);
        transform: translateX(${CFG.side==='right' ? '100%' : '-100%'});
        transition: transform .22s ease;
        z-index: calc(var(--toc-z) + 1);
        display: flex; flex-direction: column;
      }
      body.toc-open #toc-panel { transform: translateX(0); }
      body.toc-open { overflow: hidden; }

      #toc-head {
        display:flex; align-items:center; justify-content:space-between;
        gap:0.5rem; padding:.75rem .9rem; border-bottom:1px solid #eee;
      }
      #toc-head h3{ margin:0; font:600 16px system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }

      #toc-content { 
        overflow:auto; 
        padding:.6rem .85rem 1rem; 
        font-size: var(--toc-font-size);  
      }
      #toc-content nav, #toc-content .book-toc { line-height:1.5; }
      #toc-content ul { list-style:none; margin:.25rem 0; padding-left:1rem; }
      #toc-content li { margin:.1rem 0; }
      #toc-content a { text-decoration:none; }
      #toc-content .lvl-1 > a { font-weight:600; }
      #toc-content .lvl-2 > a { font-weight:500; }
      #toc-content .lvl-3 > a { font-weight:400; }

      .toc-icon-btn{
        border:1px solid #ddd; border-radius:8px; padding:.35rem .55rem; background:#fff; cursor:pointer;
      }

      /* collapsible h3 under h2 */
      .toc-caret { margin-right:.35rem; user-select:none; cursor:pointer; }
      .toc-collapsed > ul { display:none; }
      .toc-caret::before { content: '▾'; display:inline-block; transform: rotate(0deg); transition: transform .12s linear; }
      .toc-collapsed > .toc-row .toc-caret::before { transform: rotate(-90deg); }
      .toc-row { display:flex; align-items:center; gap:.25rem; }
    `;
    document.head.appendChild(style);
  }

  // Create skeleton (toggle button, backdrop, panel)
  function createShell() {
    // Toggle button (if user already has one with #toc-toggle-btn, reuse)
    let toggle = document.getElementById('toc-toggle-btn');
    if (!toggle) {
      toggle = document.createElement('button');
      toggle.id = 'toc-toggle-btn';
      toggle.type = 'button';
      toggle.setAttribute('aria-expanded','false');
      toggle.setAttribute('aria-controls','toc-panel');
      toggle.title = 'Open Table of Contents';
      toggle.textContent = '☰';
      document.body.appendChild(toggle);
    }

    // Backdrop
    let backdrop = document.getElementById('toc-backdrop');
    if (!backdrop) {
      backdrop = document.createElement('div');
      backdrop.id = 'toc-backdrop';
      backdrop.setAttribute('aria-hidden','true');
      document.body.appendChild(backdrop);
    }

    // Panel
    let panel = document.getElementById('toc-panel');
    if (!panel) {
      panel = document.createElement('aside');
      panel.id = 'toc-panel';
      panel.setAttribute('role','dialog');
      panel.setAttribute('aria-modal','true');
      panel.setAttribute('aria-label','Table of Contents');

      const head = document.createElement('div');
      head.id = 'toc-head';
      const h = document.createElement('h3'); h.textContent = 'Table of Contents';
      const close = document.createElement('button'); close.className='toc-icon-btn'; close.id='toc-close'; close.textContent='✕'; close.title='Close TOC';
      head.append(h, close);

      const content = document.createElement('div');
      content.id = 'toc-content';
      content.innerHTML = '<p><em>Loading…</em></p>';

      panel.append(head, content);
      document.body.appendChild(panel);
    }

    return { toggle, backdrop, panel };
  }

  function openTOC(toggleBtn) {
    document.body.classList.add('toc-open');
    toggleBtn?.setAttribute('aria-expanded','true');
  }
  function closeTOC(toggleBtn) {
    document.body.classList.remove('toc-open');
    toggleBtn?.setAttribute('aria-expanded','false');
  }

  // Build TOC DOM: either clone Quarto sidebar TOC or build from headings
  function findExistingTOC() {
    // Try common Quarto TOC containers
    return (
      $('nav[role="navigation"].toc-active') ||
      $('#TOC') ||
      $('nav.sidebar-navigation .toc-active') ||
      null
    );
  }

  function buildFromHeadings() {
    const container = document.createElement('div');
    container.className = 'book-toc';
    const ul1 = document.createElement('ul');

    const heads = $$(CFG.headingSelector).filter(h => {
      const level = Number(h.tagName.slice(1));
      return level >= 2 && level <= CFG.maxDepth;
    });

    let currentH2LI = null;
    heads.forEach(h => {
      const level = Number(h.tagName.slice(1));
      const id = '#' + ensureId(h);
      const a = document.createElement('a');
      a.href = id;
      a.textContent = h.textContent.trim() || (level === 2 ? 'Section' : 'Subsection');

      if (level === 2) {
        const li = document.createElement('li'); li.className = 'lvl-2';
        const row = document.createElement('div'); row.className = 'toc-row';
        const caret = document.createElement('span'); caret.className = 'toc-caret'; caret.title = 'Toggle subsections';
        row.append(caret, a);
        li.appendChild(row);

        const ul2 = document.createElement('ul'); // for h3 children
        li.appendChild(ul2);
        li.classList.add('toc-collapsed'); // start collapsed
        ul1.appendChild(li);
        currentH2LI = li;

        on(caret, 'click', () => li.classList.toggle('toc-collapsed'));
      } else if (level === 3) {
        if (!currentH2LI) {
          // Create a dummy h2 wrapper if needed
          const dummy = document.createElement('li'); dummy.className = 'lvl-2 toc-collapsed';
          const row = document.createElement('div'); row.className = 'toc-row';
          const caret = document.createElement('span'); caret.className = 'toc-caret'; caret.title = 'Toggle subsections';
          const label = document.createElement('a'); label.href = '#'; label.textContent = '(Untitled section)';
          row.append(caret, label);
          dummy.appendChild(row);
          const ul2 = document.createElement('ul'); dummy.appendChild(ul2);
          ul1.appendChild(dummy);
          currentH2LI = dummy;
          on(caret, 'click', () => dummy.classList.toggle('toc-collapsed'));
        }
        const ul2 = currentH2LI.querySelector('ul') || (() => { const u=document.createElement('ul'); currentH2LI.appendChild(u); return u; })();
        const li3 = document.createElement('li'); li3.className = 'lvl-3';
        li3.appendChild(a);
        ul2.appendChild(li3);
      }
    });

    // Wrap under a fake lvl-1 “This page”
    const li1 = document.createElement('li'); li1.className = 'lvl-1';
    const aTop = document.createElement('a'); aTop.href = '#'; aTop.textContent = document.title || 'This page';
    li1.appendChild(aTop);
    li1.appendChild(ul1);

    const rootUL = document.createElement('ul'); rootUL.appendChild(li1);
    container.appendChild(rootUL);
    return container;
  }

  function prepareLinksCloseOnClick(scopeEl, toggleBtn) {
    $$('#toc-content a', scopeEl).forEach(a => {
      on(a, 'click', () => {
        // let the browser jump first, then close to avoid covering target
        setTimeout(() => closeTOC(toggleBtn), 0);
      });
    });
  }

  // ===== Init =====
  function init() {
    injectStyles();
    const { toggle, backdrop, panel } = createShell();

    const closeBtn = $('#toc-close', panel);
    const content = $('#toc-content', panel);

    // Open/close wiring
    on(toggle, 'click', () => openTOC(toggle));
    on(closeBtn, 'click', () => closeTOC(toggle));
    on(backdrop, 'click', () => closeTOC(toggle));
    on(document, 'keydown', (e) => {
      if (e.key === 'Escape') closeTOC(toggle);
      // Cmd/Ctrl+Shift+T hotkey
      if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.code === CFG.toggleHotkey) {
        e.preventDefault();
        document.body.classList.contains('toc-open') ? closeTOC(toggle) : openTOC(toggle);
      }
    });

    // Fill content
    const existing = findExistingTOC();
    if (existing) {
      const cloned = existing.cloneNode(true);
      // If the cloned nav already has nested lists, just drop it in
      content.innerHTML = '';
      content.appendChild(cloned);
      // Optional: start with h3 collapsed if structure resembles h2>ul>li>ul
      // (Skip auto-collapse for cloned Quarto TOC to avoid fighting its JS)
      prepareLinksCloseOnClick(panel, toggle);
    } else if (CFG.buildFromHeadingsIfMissingSidebar) {
      const built = buildFromHeadings();
      content.innerHTML = '';
      content.appendChild(built);
      prepareLinksCloseOnClick(panel, toggle);
    } else {
      content.innerHTML = '<p><em>No TOC found on this page.</em></p>';
    }
  }

  // Run after DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>