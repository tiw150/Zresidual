<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Animation to Understand Z-residuals • Zresidual</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="illus_zresid_files/libs/quarto-html/popper.min.js"></script><script src="illus_zresid_files/libs/quarto-html/tippy.umd.min.js"></script><link href="illus_zresid_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="illus_zresid_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="An Animation to Understand Z-residuals">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../changelog.html" aria-label="Changelog"><span class="fa fas fa-newspaper"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An Animation to Understand Z-residuals</h1>




      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/vignettes/illus_zresid.qmd" class="external-link"><code>vignettes/illus_zresid.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="z-residuals">Z-residuals<a class="anchor" aria-label="anchor" href="#z-residuals"></a>
</h2>
<p>The <strong>Zresidual</strong> package implements diagnostic residuals based on the <strong>predictive distribution</strong> of each observation. By utilizing the full probabilistic information of the model, the package generates residuals that are approximately normally distributed. This allows for standard diagnostic techniques similar to using Pearson residuals in OLS regression.</p>
<p>For a given observation <span class="math inline">y_i</span>, the <strong>Randomized Survival Probability (RSP)</strong>—also known as the randomized probability integral transform—represents the value of the predictive survival function (upper-tail probability) at <span class="math inline">y_i</span>, adjusted with a randomization term to ensure continuity for discrete outcomes. It is defined as:</p>
<p><span id="eq-rsp"><span class="math display">RSP_i(y_i \mid \theta) = S_i(y_i \mid \theta) + U_i \, p_i(y_i \mid \theta) \tag{1}</span></span></p>
<p>where <span class="math inline">S_i</span> and <span class="math inline">p_i</span> represent the survival function and probability mass function, respectively, derived from the predictive distribution of <span class="math inline">y_i</span> given covariates <span class="math inline">\mathbf{x}_i</span> and parameters <span class="math inline">\theta</span>. <span class="math inline">U_i \sim \text{Unif}(0,1)</span> is a random uniform variable used to smooth discrete outcomes. Under a correctly specified model—where the observed data <span class="math inline">y_i</span> arises from the assumed predictive distribution—the RSP follows a <span class="math inline">\text{Unif}(0,1)</span> distribution.</p>
<p>The <strong>Z-residual</strong> (or randomized quantile residual) is derived by transforming the RSP via the inverse standard normal cumulative distribution function (CDF):</p>
<p><span id="eq-zs"><span class="math display">z_i(y_i \mid \theta) = -\Phi^{-1}\left(RSP_i(y_i \mid \theta)\right)= \Psi^{-1}\left(RSP_i(y_i \mid \theta)\right) \tag{2}</span></span></p>
<p>where <span class="math inline">\Psi^{-1}(p) = -\Phi^{-1}(p) = \Phi^{-1}(1-p)</span> represents the inverse survival function (upper-tailed quantile) of the standard normal distribution <span class="math inline">N(0,1)</span>.</p>
<p>In words, the Z-residual is simply the <span class="math inline">N(0,1)</span> value that shares the same <strong>upper-tail area (RSP)</strong> as the observed <span class="math inline">y_i</span>. This transformation effectively maps any predictive distribution to the standard normal scale while preserving the tail probabilities. If the model is correct, the resulting Z-residuals follow a standard normal distribution.</p>
<p><strong>Intuition:</strong> Think of the Z-residual as the <strong>distance to the median</strong>, but <strong>rescaled</strong> to account for skewness and <strong>smoothed</strong> to handle discreteness. This ensures that a residual of <span class="math inline">+2</span> always implies the same degree of ‘extremeness’, regardless of the original distribution’s shape.</p>
</section><section class="level2"><h2 id="z-residuals-of-a-true-model">Z-residuals of a True Model<a class="anchor" aria-label="anchor" href="#z-residuals-of-a-true-model"></a>
</h2>
<p>The animation in <strong><strong>?@fig-aniz-true</strong></strong> demonstrates this transformation for <span class="math inline">y_i</span> using its true predictive distribution. As more points are simulated, the distribution of <span class="math inline">z_i</span> values (shown by the accumulating points) aligns with the theoretical <span class="math inline">N(0,1)</span> density curve.</p>
<div class="cell fig-cap-location-top">
<div class="cell-output-display">
<div id="fig-aniz-correct" class="quarto-float quarto-figure quarto-figure-center" data-cap-location="top">
<figure class="quarto-float quarto-float-fig"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-aniz-correct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Z-residuals under a correctly specified model. <strong>Meters:</strong> Top and bottom bars show identical probability structures. <strong>Top Plot:</strong> Data <span class="math inline">y_i</span> generated from the True Model (<span class="math inline">\mu=3</span>) are evaluated against the same Postulated Model (<span class="math inline">\mu=3</span>). <strong>Bottom Plot:</strong> Because the model is correct, the Z-residuals (red dots) follow the Standard Normal density.
</figcaption><div aria-describedby="fig-aniz-correct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="z_residual_anim-correct.gif">
</div>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h2 id="z-residuals-of-a-wrong-model">Z-residuals of a Wrong Model<a class="anchor" aria-label="anchor" href="#z-residuals-of-a-wrong-model"></a>
</h2>
<p>The animation in <strong><a href="#fig-aniz-wrong" class="quarto-xref">Figure 2</a></strong> demonstrates the behavior of Z-residuals when the model is misspecified. Here, the data <span class="math inline">y_i</span> are simulated from a <strong>True Model</strong> (Negative Binomial with <span class="math inline">\mu=3</span>), but the residuals are calculated based on a <strong>Postulated Model</strong> (Negative Binomial with <span class="math inline">\mu=5</span>).</p>
<p>The plotting window is fixed to the <strong>Postulated Model</strong> (the expectation). You can see that the observed data (solid bars) fall systematically to the left of the expected distribution (dashed bars). Because the observed values are smaller than expected, the calculated <span class="math inline">RSP</span> values are consistently high (upper tail area is large), resulting in <span class="math inline">z_i</span> values that drift toward the negative side of the standard normal distribution.</p>
<div class="cell fig-cap-location-top">
<div class="cell-output-display">
<div id="fig-aniz-wrong" class="quarto-float quarto-figure quarto-figure-center" data-cap-location="top">
<figure class="quarto-float quarto-float-fig"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-aniz-wrong-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Z-residuals under a misspecified model. <strong>Meters:</strong> Top bar shows True generating probabilities; bottom bar shows RSP calculation. <strong>Top Plot:</strong> Data <span class="math inline">y_i</span> are generated from the True Model (<span class="math inline">\mu=3</span>, solid) but evaluated against the Postulated Model (<span class="math inline">\mu=5</span>, dashed). Consequently, observed counts consistently fall in the lower tail of the postulated distribution. <strong>Bottom Plot:</strong> This mismatch biases the cumulative probabilities downward, causing the Z-residuals (red dots) to drift systematically to the left of the Standard Normal density.
</figcaption><div aria-describedby="fig-aniz-wrong-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="z_residual_anim-wrong.gif">
</div>
</figure>
</div>
</div>
</div>
<p>```</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
