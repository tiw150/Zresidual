<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Z-residual Diagnosis for Logistic Regression • Zresidual</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Z-residual Diagnosis for Logistic Regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Z-residual Diagnosis for Logistic Regression</h1>
            
            <h4 data-toc-skip class="date">2025-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/vignettes/vignette_logistic.Rmd" class="external-link"><code>vignettes/vignette_logistic.Rmd</code></a></small>
      <div class="d-none name"><code>vignette_logistic.Rmd</code></div>
    </div>

    
    
<style>
body, .container-fluid, .main-container {
  max-width: 100% !important;
  width: 95%;
  margin: auto;
  panmes.dataing: 20px;
}

h1 {
  color: darkred;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use the <code>Zresidual</code>
package to compute Z-residuals for diagnosing Logistic regression, based
on the output from the <code>brms</code> package in R <span class="citation">[@Burkner2017-brms]</span> to reveal potential model
misspecifications. The examples illustrate the practical use of these
residuals for <abbr title="Randomized Predictive P-value">RPP</abbr>
<span class="citation">[@Feng2020]</span> diagnostics.</p>
</div>
<div class="section level2">
<h2 id="definitions-of-z-residuals-for-logistic-regression">Definitions of Z-residuals for Logistic Regression<a class="anchor" aria-label="anchor" href="#definitions-of-z-residuals-for-logistic-regression"></a>
</h2>
<p>This section demonstrates the definitions of posterior predictive
quantities including the posterior predictive
<abbr title="Probability Mass Function">PMF</abbr>, survival function,
and <abbr title="Randomized Predictive P-value">RPP</abbr> for Logistic
Regression.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">y_i \in \{0, 1\}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y_i = 1</annotation></semantics></math>
indicates a success, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_i = 0</annotation></semantics></math>
indicates a failure for the <span class="math inline">$i^\th$</span>
observations.</p>
<p>Using Bayesian estimation (e.g., via the <code>brms</code> package),
we draw
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
samples from the posterior distribution. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\theta^{(t)}</annotation></semantics></math>
denote the <span class="math inline">$t^\th$</span> posterior draw.</p>
<p>For a given observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><annotation encoding="application/x-tex">y_i^\text{obs}</annotation></semantics></math>,
the posterior predictive
<abbr title="Probability Mass Function">PMF</abbr> and survival
functions are defined below.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>p</mi><mi>i</mi><mrow><mtext mathvariant="normal">post</mtext><mo>,</mo><mtext mathvariant="normal">logit</mtext></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mi>T</mi></mfrac><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msup><msubsup><mi>π</mi><mi>i</mi><mi>o</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn><mo>−</mo><msup><msubsup><mi>π</mi><mi>i</mi><mi>o</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>=</mo><mn>0</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise.</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
p_i^{\text{post}, \text{logit}}(y_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T 
\begin{cases}
{\pi^o_i}^{(t)} &amp; \text{if } y_i^\text{obs} = 1, \\
1 - {\pi^o_i}^{(t)} &amp; \text{if } y_i^\text{obs} = 0,\\
0 &amp; \text{otherwise.}
\end{cases}
\end{equation}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>S</mi><mi>i</mi><mrow><mtext mathvariant="normal">post</mtext><mo>,</mo><mtext mathvariant="normal">logit</mtext></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mi>T</mi></mfrac><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>&lt;</mo><mn>0</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn><mo>−</mo><msup><msubsup><mi>π</mi><mi>i</mi><mi>o</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mn>0</mn><mo>≤</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>&lt;</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo>≥</mo><mn>1</mn><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
S_i^{\text{post}, \text{logit}}(y_i^\text{obs}) = \frac{1}{T} \sum_{t=1}^T 
\begin{cases}
1 &amp; \text{if } y_i^\text{obs} &lt; 0, \\
1-{\pi^o_i}^{(t)} &amp; \text{if } 0 \le y_i^\text{obs} &lt; 1, \\
0, &amp; \text{if } y_i^\text{obs} \ge 1. 
\end{cases}
\end{equation}</annotation></semantics></math></p>
<p>For any observed value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><annotation encoding="application/x-tex">y_i^\text{obs}</annotation></semantics></math>,
we define:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">rpp</mtext><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="false" form="prefix">|</mo><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>S</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="false" form="prefix">|</mo><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>U</mi><mi>i</mi></msub><mo>×</mo><msub><mi>p</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="false" form="prefix">|</mo><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\label{eq:post_rpp}\text{rpp}_i(y_i^\text{obs} | \theta^{(t)}) = S_i(y_i^\text{obs} | \theta^{(t)}) + U_i \times p_i(y_i^\text{obs} | \theta^{(t)})
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub><mo>∼</mo><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">U_i \sim \text{Uniform}(0,1)</annotation></semantics></math>.
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><annotation encoding="application/x-tex">y_i^\text{obs}</annotation></semantics></math>
is the observed value, which can refer to either success or failure.
Then, the Z-residual of the response variable is,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><mi>−</mi><msup><mi>Φ</mi><mrow><mi>−</mi><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">rpp</mtext><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>y</mi><mi>i</mi><mtext mathvariant="normal">obs</mtext></msubsup><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\label{eq:z_residual}
z_i = -\Phi^{-1}(\text{rpp}_i(y_i^\text{obs}|\theta)) \sim N(0, 1)
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Φ</mi><mrow><mi>−</mi><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Phi^{-1}(.)</annotation></semantics></math>
is the quantile function of standard normal distribution.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#devtools::install_github("tiw150/Zresidual")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-simulation-example">A Simulation Example<a class="anchor" aria-label="anchor" href="#a-simulation-example"></a>
</h2>
<div class="section level3">
<h3 id="model-fitting-with-brms">Model fitting with <code>brms</code><a class="anchor" aria-label="anchor" href="#model-fitting-with-brms"></a>
</h3>
<p>To demonstrate how <code>Zresidual</code> works with hurdle models,
we first simulate data from a
<abbr title="Hurdle Negative Binomial">HNB</abbr> model. This simulated
dataset allows us to evaluate how well the model and residual
diagnostics perform when the true data-generating process is known.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulation parameters</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">beta2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Predictors</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generating response variable</span></span>
<span><span class="va">logit_p</span> <span class="op">&lt;-</span> <span class="va">beta0</span> <span class="op">+</span> <span class="va">beta1</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="va">beta2</span><span class="op">*</span><span class="va">x2</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit_p</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit_p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="va">p</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="co"># Random error variables</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of random effect</span></span>
<span><span class="va">sample_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">j</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">sample_experiment</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">j</span>, byrow<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">z_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">z_names</span></span>
<span>  </span>
<span><span class="va">data_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">z</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="va">j</span><span class="op">+</span><span class="fl">2</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data_logit</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">k</span><span class="op">]</span></span>
<span><span class="va">logit_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"y ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">predictors</span>, collapse<span class="op">=</span><span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This dataset includes a continuous predictor <code>x1</code>, binary
variable <code>x2</code>, and five random error variables
<code>z1, z2, z3, z4, z5</code> and the outcome <code>y</code> is
generated from a Bernoulli process. Note that the error variables are
not included in generating the <code>y</code> outcome variable.</p>
<p>Now, we use the <code>brms</code> package to fit a logistic
regression model to the simulated data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/matrixStats" class="external-link">matrixStats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tiw150.github.io/Zresidual">Zresidual</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="co">#fit_logit &lt;- brm(bf(logit_formula),</span></span>
<span><span class="co">#               data = data_logit, </span></span>
<span><span class="co">#               family = bernoulli())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/Desktop/Zresidual/vignettes/fit_logit.Rdata"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>family = bernoulli()</code> tells <code>brms</code> to use
a logistic regression for binary response. We use default parameter
setting on this example to fit the model.</p>
</div>
<div class="section level3">
<h3 id="computing-z-residuals">Computing Z-residuals<a class="anchor" aria-label="anchor" href="#computing-z-residuals"></a>
</h3>
<p>In this example, we compute Z-residuals for the logistic regression
using <code><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli()</a></code>. The package take
<code>brms</code> fit as an input for the
<code><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli()</a></code> function. If the model is Hurdle
model, the <code>type</code> argument
(<code>"zero", "count" or "hurdle"</code>) specifies which component to
use when calculating the residuals. By default, Z-residuals are computed
using the Importance Sampling Cross-Validation (<code>iscv</code>)
method based on randomized predictive p-values
(<abbr title="Randomized Predictive P-value">RPP</abbr>). Alternatively,
users can choose the standard Posterior
<abbr title="Randomized Predictive P-value">RPP</abbr> method by setting
<code>method = "post"</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zres_logit_iscv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli</a></span><span class="op">(</span><span class="va">fit_logit</span><span class="op">)</span></span>
<span><span class="va">zres_logit_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli</a></span><span class="op">(</span><span class="va">fit_logit</span>, method <span class="op">=</span> <span class="st">"rpost"</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="what-the-function-returns">
<strong>What the function returns</strong><a class="anchor" aria-label="anchor" href="#what-the-function-returns"></a>
</h5>
<p>The function <code><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli()</a></code> (and other Z-residual
computing functions) returns a matrix of Z-residuals, with additional
attributes. The returned object is of class <code>zresid</code>, which
includes metadata useful for diagnostic and plotting purposes.</p>
<p><strong>Return Value</strong></p>
<p>A numeric matrix of dimension <code>n × nrep</code>, where
<code>n</code> is the number of observations in the data and
<code>nrep</code> is the number of randomized replicates of Z-residuals
(default is 1). Each column represents a set of Z-residuals computed
from a <abbr title="Randomized Predictive P-value">RPP</abbr>, using
either posterior (<code>post</code>) or importance sampling
cross-validation (<code>iscv</code>) log predictive distributions.</p>
<p><strong>Matrix Attributes</strong></p>
The returned matrix includes the following attached attributes:
<ul>
<li>
<code>type</code>: The component of the hurdle model the residuals
correspond to. One of “zero”, “count”, or “hurdle”. For logistic, type
is returned as “zero”.
</li>
<li>
<code>zero_id</code>: Indices of observations where the response value
was 0. Useful for separating diagnostics by zero and non-zero parts.
</li>
<li>
<code>log_pmf</code>: A matrix of log predictive probabilities
(log-<abbr title="Probability Mass Function">PMF</abbr>) per observation
and posterior draw.
</li>
<li>
<code>log_cdf</code>: A matrix of log predictive CDF values used in
computing the <abbr title="Randomized Predictive P-value">RPP</abbr>s.
</li>
<li>
<code>covariates</code>: A data frame containing the covariates used in
the model (excluding the response variable). This can be used for
plotting or conditional diagnostics.
</li>
<li>
<code>fitted.value</code>: The posterior mean predicted value for each
observation depending on the type.
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="diagnostic-tools-for-z-residuals">Diagnostic Tools for Z-Residuals<a class="anchor" aria-label="anchor" href="#diagnostic-tools-for-z-residuals"></a>
</h3>
<div class="section level5">
<h5 id="visualizing-z-residuals">Visualizing Z-residuals<a class="anchor" aria-label="anchor" href="#visualizing-z-residuals"></a>
</h5>
The <code>Zresidual</code> package includes built-in plotting functions
(QQ Plot, Scatter Plot, Boxplot) to help diagnose model fit using
Z-residuals. These functions are designed to work directly with objects
of class <code>zresid</code> returned by functions like
<code><a href="../reference/Zresidual.bernoulli.html">Zresidual.bernoulli()</a></code>. These plots help assess:
<ul>
<li>
Whether residuals are approximately standard normal (via QQ plots),
</li>
<li>
Whether there are patterns in residuals across fitted values (which may
suggest model misspecification),
</li>
<li>
Whether residuals differ across covariates (optional extensions).
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/qqnorm.zresid.html">qqnorm.zresid</a></span><span class="op">(</span><span class="va">zres_logit_iscv</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.zresid.html">plot.zresid</a></span><span class="op">(</span><span class="va">zres_logit_iscv</span>, X<span class="op">=</span><span class="st">"x2"</span>, outlier.return <span class="op">=</span> <span class="cn">TRUE</span>,categor<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/boxplot.zresid.html">boxplot.zresid</a></span><span class="op">(</span><span class="va">zres_logit_iscv</span>, X<span class="op">=</span><span class="st">"lp"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_logistic_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/qqnorm.zresid.html">qqnorm.zresid</a></span><span class="op">(</span><span class="va">zres_logit_post</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.zresid.html">plot.zresid</a></span><span class="op">(</span><span class="va">zres_logit_post</span>, X<span class="op">=</span><span class="st">"x2"</span>, outlier.return <span class="op">=</span> <span class="cn">TRUE</span>,categor<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/boxplot.zresid.html">boxplot.zresid</a></span><span class="op">(</span><span class="va">zres_logit_post</span>, X<span class="op">=</span><span class="st">"lp"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette_logistic_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" width="700"></p>
<p>The diagnostic evaluations for the model—comprising scatter plots,
Q-Q plots, and boxplots of Z-residuals—demonstrate that the model
adequately captures the data structure. The Z-residuals are evenly
scattered around zero and mostly fall within the range of -3 to 3,
indicating no visible model misfit. The “count” represent success while
“zero” represent failure. Complementary statistical tests, including the
<abbr title="Shapiro-Wilk">SW</abbr> test for normality,
<abbr title="Analysis of Variance">ANOVA</abbr> for mean equality, and
<abbr title="Bartlett's">BL</abbr> test for variance homogeneity, all
return p-values above the 0.05 threshold. This suggests that the
residuals follow a normal distribution and exhibit equal means and
variances across fitted value intervals. The Q-Q plots further support
normality through close alignment with the 45-degree reference line,
while the boxplots confirm consistent residual means across partitions.
Collectively, these diagnostics validate that the model satisfies key
distributional assumptions and that the proposed Z-residual methods are
effective in detecting model adequacy.</p>
<p>The plotting functions in the Zresidual package are designed to be
flexible and lightweight, allowing users to quickly visualize residual
patterns. These functions support all customizable arguments in base
<code>R</code> functions such as axes, labels etc. by making them
adaptable to a wide range of diagnostic workflows. The
<code><a href="../reference/plot.zresid.html">plot.zresid()</a></code> function offers flexible diagnostic plotting
for Z-residuals, supporting various x-axes such as index, fitted values,
and covariates. Both <code><a href="../reference/plot.zresid.html">plot.zresid()</a></code> and
<code><a href="../reference/qqnorm.zresid.html">qqnorm.zresid()</a></code> automatically highlights outlier residuals
that fall outside the typical (or user specified) range making it easier
to identify problematic observations.</p>
</div>
<div class="section level5">
<h5 id="statistical-tests">Statistical Tests<a class="anchor" aria-label="anchor" href="#statistical-tests"></a>
</h5>
<p>In addition to visual diagnostics, the package offers formal
statistical tests to quantify deviations from normality or homogeneity
of variance in Z-residuals by taking an <code>zresid</code> class object
as an input.</p>
<p><strong>Shapiro-Wilk Test for Normality
(<abbr title="Shapiro-Wilk">SW</abbr>)</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sw.test.zresid.html">sw.test.zresid</a></span><span class="op">(</span><span class="va">zres_logit_iscv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.18219</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sw.test.zresid.html">sw.test.zresid</a></span><span class="op">(</span><span class="va">zres_logit_post</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.497763</span></span></code></pre>
<p><strong>Analysis of Variance
(<abbr title="Analysis of Variance">ANOVA</abbr>)</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aov.test.zresid.html">aov.test.zresid</a></span><span class="op">(</span><span class="va">zres_logit_iscv</span>, X<span class="op">=</span><span class="st">"lp"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6287762</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aov.test.zresid.html">aov.test.zresid</a></span><span class="op">(</span><span class="va">zres_logit_post</span>, X<span class="op">=</span><span class="st">"lp"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.20119</span></span></code></pre>
<p><strong>Bartlett Test
(<abbr title="Bartlett's">BL</abbr>)</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#bartlett.test.zresid(zres_logit_iscv, X="lp")</span></span>
<span><span class="co">#bartlett.test.zresid(zres_logit_post, X="lp")</span></span></code></pre></div>
<p>These tests return standard <code>htest</code> or <code>aov</code>
objects, making them easy to report, summarize, or integrate into
automated workflows. One advantage of the visualization functions
provided by the <code>Zresidual</code> package is that they allow users
to diagnose the model both visually and using statistical tests
simultaneously.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="other-functions">Other Functions<a class="anchor" aria-label="anchor" href="#other-functions"></a>
</h2>
<p>In addition to Z-residual computation and visualization, the
<code>Zresidual</code> package provides several utility functions to
support deeper model diagnostics and probabilistic analysis including
functions for calculating the logarithmic predictive p-values
(<code><a href="../reference/post_logrpp.html">post_logrpp()</a></code>, <code><a href="../reference/iscv_logrpp.html">iscv_logrpp()</a></code>). The package
also includes dedicated functions to compute the logarithmic PDFs and
CDFs for supported distributions. These can be used to manually inspect
likelihood components or to derive custom model evaluation metrics. The
log-scale calculations offer improved numerical stability, especially
when dealing with small probabilities. These tools integrate seamlessly
with outputs from Bayesian models fitted using <code>brms</code>,
maintaining compatibility and flexibility. Together, they extend the
package’s functionality beyond residual analysis, supporting a
comprehensive and rigorous approach to Bayesian model checking.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Hettiarachchige Alias Egodage Dananji, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
