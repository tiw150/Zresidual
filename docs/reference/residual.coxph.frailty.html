<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Residuals for shared frailty Cox proportional hazards models — residual.coxph.frailty • Zresidual</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Residuals for shared frailty Cox proportional hazards models — residual.coxph.frailty"><meta name="description" content="Compute several types of residuals (censored Z-residuals, Cox–Snell,
martingale, and deviance) for shared frailty Cox proportional hazards
models fitted with coxph using a multiplicative
frailty term (e.g., frailty(group))."><meta property="og:description" content="Compute several types of residuals (censored Z-residuals, Cox–Snell,
martingale, and deviance) for shared frailty Cox proportional hazards
models fitted with coxph using a multiplicative
frailty term (e.g., frailty(group))."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Residuals for shared frailty Cox proportional hazards models</h1>
      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/R/residual.coxph.R" class="external-link"><code>R/residual.coxph.R</code></a></small>
      <div class="d-none name"><code>residual.coxph.frailty.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute several types of residuals (censored Z-residuals, Cox–Snell,
martingale, and deviance) for shared frailty Cox proportional hazards
models fitted with <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> using a multiplicative
frailty term (e.g., <code>frailty(group)</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">residual.coxph.frailty</span><span class="op">(</span></span>
<span>  <span class="va">fit_coxph</span>,</span>
<span>  <span class="va">traindata</span>,</span>
<span>  <span class="va">newdata</span>,</span>
<span>  residual.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"censored Z-residual"</span>, <span class="st">"Cox-Snell"</span>, <span class="st">"martingale"</span>, <span class="st">"deviance"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fit-coxph">fit_coxph<a class="anchor" aria-label="anchor" href="#arg-fit-coxph"></a></dt>
<dd><p>A fitted <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> object for a shared
frailty Cox model, typically specified with a term such as
<code>frailty(group)</code> in the model formula. The object must contain
cluster-level frailty estimates in <code>fit_coxph$frail</code>.</p></dd>


<dt id="arg-traindata">traindata<a class="anchor" aria-label="anchor" href="#arg-traindata"></a></dt>
<dd><p>A <code>data.frame</code> used to reconstruct the baseline
hazard and frailty effects. It must contain the survival response, all
fixed-effect covariates, and the shared frailty grouping factor appearing
in <code>fit_coxph$formula</code>.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>A <code>data.frame</code> for which residuals are to be computed.
It must contain the survival response, covariates, and the shared frailty
grouping factor used in the original model. The factor levels of the
grouping variable must be compatible with those in <code>traindata</code>.</p></dd>


<dt id="arg-residual-type">residual.type<a class="anchor" aria-label="anchor" href="#arg-residual-type"></a></dt>
<dd><p>Character string specifying the type of residual to
compute. Must be one of <code>"censored Z-residual"</code>, <code>"Cox-Snell"</code>,
<code>"martingale"</code>, or <code>"deviance"</code>. The default is the full vector
<code>c("censored Z-residual", "Cox-Snell", "martingale", "deviance")</code>,
but in typical use a single value should be supplied.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric matrix of dimension \(n \times 1\), where \(n\) is
  the number of observations in <code>newdata</code>. The single column is named
  according to <code>residual.type</code>. Several attributes are attached:</p><ul><li><p><code>Survival.Prob</code>: vector of survival probabilities
      \(S_{ij}(t_i)\) for each observation in <code>newdata</code>.</p></li>
<li><p><code>linear.pred</code>: vector of fixed-effect linear predictors
      \(\eta_{ij}\) (excluding the frailty term).</p></li>
<li><p><code>covariates</code>: model matrix of fixed-effect covariates
      used in the linear predictor.</p></li>
<li><p><code>censored.status</code>: event indicator (1 = event, 0 = censored).</p></li>
<li><p><code>object.model.frame</code>: the <code>model.frame</code> constructed
      from <code>fit_coxph$formula</code> and <code>newdata</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function is designed for an out-of-sample / cross-validation setting:</p><ul><li><p><code>traindata</code> is used to reconstruct the baseline cumulative
        hazard and the relationship between covariates and shared frailty.</p></li>
<li><p><code>newdata</code> is the dataset for which residuals are computed.</p></li>
</ul><p>Both datasets must contain the survival response, all fixed-effect
covariates, and the same frailty grouping factor (with compatible factor
levels). The grouping variable is extracted from the <code><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty()</a></code>
term in <code>fit_coxph$formula</code> and must be a factor in both
<code>traindata</code> and <code>newdata</code>. The internal implementation treats
models with many groups (<code>gpnumber &gt; 5</code>) and few groups
(<code>gpnumber &lt;= 5</code>) slightly differently, reflecting how frailty
coefficients are stored in the fitted <code>coxph</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lung</span><span class="op">$</span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lung</span><span class="op">$</span><span class="va">inst</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Shared frailty Cox model</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.7</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">train_dat</span> <span class="op">&lt;-</span> <span class="va">lung</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">test_dat</span>  <span class="op">&lt;-</span> <span class="va">lung</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">fit_frail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">inst</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">train_dat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Censored Z-residuals on the test set</span></span></span>
<span class="r-in"><span>  <span class="va">r_z</span> <span class="op">&lt;-</span> <span class="fu">residual.coxph.frailty</span><span class="op">(</span><span class="va">fit_frail</span>,</span></span>
<span class="r-in"><span>                                traindata <span class="op">=</span> <span class="va">train_dat</span>,</span></span>
<span class="r-in"><span>                                newdata   <span class="op">=</span> <span class="va">test_dat</span>,</span></span>
<span class="r-in"><span>                                residual.type <span class="op">=</span> <span class="st">"censored Z-residual"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Cox–Snell residuals</span></span></span>
<span class="r-in"><span>  <span class="va">r_cs</span> <span class="op">&lt;-</span> <span class="fu">residual.coxph.frailty</span><span class="op">(</span><span class="va">fit_frail</span>,</span></span>
<span class="r-in"><span>                                 traindata <span class="op">=</span> <span class="va">train_dat</span>,</span></span>
<span class="r-in"><span>                                 newdata   <span class="op">=</span> <span class="va">test_dat</span>,</span></span>
<span class="r-in"><span>                                 residual.type <span class="op">=</span> <span class="st">"Cox-Snell"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

