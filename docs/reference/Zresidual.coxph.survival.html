<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Z-residuals for Cox proportional hazards models (survival package) — Zresidual.coxph.survival • Zresidual</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Z-residuals for Cox proportional hazards models (survival package) — Zresidual.coxph.survival"><meta name="description" content="Zresidual.coxph.survival() computes randomized Z-residuals for Cox
proportional hazards models fitted with coxph,
supporting both standard and shared frailty models. This S3 method is
designed to be called via the generic function Zresidual.
The function automatically detects the presence of a frailty term (e.g.,
frailty(group)) and dispatches the calculation to one of two
internal implementations. These residuals are intended for in-sample
diagnostics and model assessment."><meta property="og:description" content="Zresidual.coxph.survival() computes randomized Z-residuals for Cox
proportional hazards models fitted with coxph,
supporting both standard and shared frailty models. This S3 method is
designed to be called via the generic function Zresidual.
The function automatically detects the presence of a frailty term (e.g.,
frailty(group)) and dispatches the calculation to one of two
internal implementations. These residuals are intended for in-sample
diagnostics and model assessment."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../changelog.html" aria-label="Changelog"><span class="fa fas fa-newspaper"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Z-residuals for Cox proportional hazards models (survival package)</h1>
      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/R/Zresidual.coxph.survival.R" class="external-link"><code>R/Zresidual.coxph.survival.R</code></a></small>
      <div class="d-none name"><code>Zresidual.coxph.survival.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>Zresidual.coxph.survival()</code> computes randomized Z-residuals for Cox
proportional hazards models fitted with <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code>,
supporting both standard and shared frailty models. This S3 method is
designed to be called via the generic function <code><a href="Zresidual.html">Zresidual</a></code>.</p>
<p>The function automatically detects the presence of a frailty term (e.g.,
<code>frailty(group)</code>) and dispatches the calculation to one of two
internal implementations. These residuals are intended for <strong>in-sample</strong>
diagnostics and model assessment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'coxph.survival'</span></span>
<span><span class="fu"><a href="Zresidual.html">Zresidual</a></span><span class="op">(</span><span class="va">object</span>, nrep <span class="op">=</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="cn">NULL</span>, method <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A fitted <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> model. Supports
both standard Cox models and shared frailty models.</p></dd>


<dt id="arg-nrep">nrep<a class="anchor" aria-label="anchor" href="#arg-nrep"></a></dt>
<dd><p>Integer; number of independent randomized Z-residual
replicates to generate. Defaults to <code>1</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Optional <code>data.frame</code> containing the survival response
and covariates. When <code>NULL</code> (default), the residuals are computed
on the data used to fit the <code>object</code>. This parameter is often aliased
as <code>newdata</code> in the internal worker functions.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Optional character string controlling the residual type.
Set internally to <code>"survival"</code> for Cox models.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string specifying the residual calculation method.
Currently unused.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to the underlying implementation
functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric matrix of class <code>"zresid"</code> with dimension \(N \times nrep\).
Each column is an independent set of Z-residuals. The following diagnostic
attributes are attached:</p><ul><li><p><code>Survival.Prob</code>: Vector of predicted survival probabilities \(S_i(t_i)\).</p></li>
<li><p><code>linear.pred</code>: Vector of linear predictors \(\eta_i = \mathbf{x}_i \mathbf{\hat{\beta}}\).</p></li>
<li><p><code>covariates</code>: Data frame of covariates used in the model.</p></li>
<li><p><code>censored.status</code>: Event indicator (1 = event, 0 = censored).</p></li>
<li><p><code>object.model.frame</code>: The <code>model.frame</code> used for computation.</p></li>
<li><p><code>type</code>: Character string, always <code>"survival"</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This method dispatches work based on the model formula:</p>
<ul><li><p><strong>Standard Cox models (No Frailty)</strong>:</p>
<p>The function calls <code><a href="Zresidual_coxph_survival.html">Zresidual_coxph_survival</a></code> to compute
Z-residuals using the fixed effects (\(\mathbf{x}\hat{\mathbf{\beta}}\)) and the
estimated baseline cumulative hazard function \(\hat{H}_0(t)\).</p></li>
<li><p><strong>Shared Frailty Cox models</strong>:</p>
<p>The function calls <code><a href="Zresidual_coxph_frailty_survival.html">Zresidual_coxph_frailty_survival</a></code>. This
implementation computes residuals accounting for the cluster-level frailty
effect (\(\hat{z}_{\text{group}}\)). It requires the data used for fitting
(<code>traindata</code>) to reconstruct the baseline hazard and estimate the
frailty term.</p></li>
</ul><p><strong>Randomization for Censored Observations:</strong>
Since the true survival probability for a censored observation $i$ is known
only to be greater than \(S_i(t_i)\), the Z-residual uses a randomized survival
probability: \(S_{i, \text{rand}}(t_i) = S_i(t_i) \cdot U\), where \(U \sim \text{Unif}(0, 1)\).
This randomization is repeated <code>nrep</code> times.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="Zresidual.html">Zresidual</a></code>,
<code><a href="Zresidual_coxph_survival.html">Zresidual_coxph_survival</a></code>,
<code><a href="Zresidual_coxph_frailty_survival.html">Zresidual_coxph_frailty_survival</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Standard Cox model (no frailty term)</span></span></span>
<span class="r-in"><span>  <span class="va">fit_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Note: The internal class 'coxph.survival' is usually added by a wrapper,</span></span></span>
<span class="r-in"><span>  <span class="co"># but Zresidual() handles dispatch automatically.</span></span></span>
<span class="r-in"><span>  <span class="va">z_cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="Zresidual.html">Zresidual</a></span><span class="op">(</span><span class="va">fit_cox</span>, nrep <span class="op">=</span> <span class="fl">10</span>, data <span class="op">=</span> <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Shared frailty Cox model (in-sample residuals)</span></span></span>
<span class="r-in"><span>  <span class="co"># Note: 'inst' must be a grouping factor.</span></span></span>
<span class="r-in"><span>  <span class="va">lung</span><span class="op">$</span><span class="va">inst_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lung</span><span class="op">$</span><span class="va">inst</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fit_frail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">inst_f</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">z_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="Zresidual.html">Zresidual</a></span><span class="op">(</span><span class="va">fit_frail</span>, nrep <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

