<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Z-residuals for shared frailty Cox proportional hazards models — Zresidual.coxph.frailty • Zresidual</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Z-residuals for shared frailty Cox proportional hazards models — Zresidual.coxph.frailty"><meta name="description" content="This function calculates randomized Z-residuals for shared frailty survival
models fitted with coxph using a multiplicative
frailty term (e.g., frailty(group))."><meta property="og:description" content="This function calculates randomized Z-residuals for shared frailty survival
models fitted with coxph using a multiplicative
frailty term (e.g., frailty(group))."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Z-residuals for shared frailty Cox proportional hazards models</h1>
      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/R/Zresidual.coxph.frailty.R" class="external-link"><code>R/Zresidual.coxph.frailty.R</code></a></small>
      <div class="d-none name"><code>Zresidual.coxph.frailty.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates randomized Z-residuals for shared frailty survival
models fitted with <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> using a multiplicative
frailty term (e.g., <code>frailty(group)</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Zresidual.coxph.frailty</span><span class="op">(</span><span class="va">fit_coxph</span>, <span class="va">traindata</span>, <span class="va">newdata</span>, n.rep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fit-coxph">fit_coxph<a class="anchor" aria-label="anchor" href="#arg-fit-coxph"></a></dt>
<dd><p>A fitted <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> object for a shared
frailty model, typically specified with a term such as
<code>frailty(group)</code> in the model formula. The object must contain the
cluster-level frailty estimates in <code>fit_coxph$frail</code>.</p></dd>


<dt id="arg-traindata">traindata<a class="anchor" aria-label="anchor" href="#arg-traindata"></a></dt>
<dd><p>Optional <code>data.frame</code> used to reconstruct the baseline
hazard and frailty effects when computing out-of-sample residuals. It must
contain the survival response, all fixed-effect covariates, and the shared
frailty grouping factor appearing in <code>fit_coxph$formula</code>. Set to
<code>NULL</code> (default) when computing in-sample residuals from the fitted
object only.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>Optional <code>data.frame</code> for which Z-residuals are to be
computed in the out-of-sample / cross-validation setting. It must contain
the survival response, covariates, and the shared frailty grouping factor
used in the original model. When <code>newdata</code> is not <code>NULL</code>,
<code>traindata</code> must also be supplied. In the in-sample mode,
<code>newdata</code> must be <code>NULL</code>.</p></dd>


<dt id="arg-n-rep">n.rep<a class="anchor" aria-label="anchor" href="#arg-n-rep"></a></dt>
<dd><p>Integer; number of independent randomized Z-residual replicates
to generate. Defaults to <code>1</code>. Each replicate corresponds to a
different randomization of the censored observations.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric matrix of dimension \(n \times\) <code>n.rep</code>, where
  \(n\) is the number of observations in the relevant model frame
  (original data in the in-sample mode, or <code>newdata</code> in the
  out-of-sample mode). Each column corresponds to one set of randomized
  Z-residuals. The returned matrix has the following attributes attached:</p><ul><li><p><code>Survival.Prob</code>: vector of survival probabilities
      \(S_{ij}(t_i)\) for each observation.</p></li>
<li><p><code>linear.pred</code>: vector of fixed-effect linear predictors
      \(\eta_{ij}\) (excluding the frailty term).</p></li>
<li><p><code>covariates</code>: data frame of fixed-effect covariates (model
      frame without the survival response and grouping factor).</p></li>
<li><p><code>censored.status</code>: event indicator (1 = event, 0 = censored).</p></li>
<li><p><code>object.model.frame</code>: the <code>model.frame</code> used to compute
      the residuals (training frame in the in-sample mode, prediction frame
      in the out-of-sample mode).</p></li>
<li><p><code>type</code>: character string <code>"survival"</code> (if set in the
      current implementation).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are two main usage modes:</p><ul><li><p><strong>In-sample mode</strong>:
  If both <code>traindata</code> and <code>newdata</code> are <code>NULL</code>, the function
  extracts the model frame, covariates, and shared frailty structure
  directly from <code>fit_coxph</code> and computes Z-residuals for the original
  data used to fit the shared frailty model. The grouping variable for the
  frailty term is assumed to be the last column of the model frame and must
  be a factor.</p></li>
<li><p><strong>Out-of-sample / cross-validation mode</strong>:
  If both <code>traindata</code> and <code>newdata</code> are provided, the baseline
  cumulative hazard and frailty effects are reconstructed using
  <code>traindata</code>, while Z-residuals are computed for <code>newdata</code>. In
  this case, both datasets must contain the survival response, all fixed
  effects covariates, and the same shared frailty grouping factor (with
  compatible factor levels). Mixed cases where only one of <code>traindata</code>
  or <code>newdata</code> is supplied are not supported.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Shared frailty Cox model (in-sample residuals)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lung</span><span class="op">$</span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lung</span><span class="op">$</span><span class="va">inst</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fit_frail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">inst</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">lung</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">z_in</span> <span class="op">&lt;-</span> <span class="fu">Zresidual.coxph.frailty</span><span class="op">(</span><span class="va">fit_frail</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Simple train/test split for out-of-sample residuals</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">0.7</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lung</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">train_dat</span> <span class="op">&lt;-</span> <span class="va">lung</span><span class="op">[</span><span class="va">idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">test_dat</span>  <span class="op">&lt;-</span> <span class="va">lung</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">fit_frail_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">inst</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        data <span class="op">=</span> <span class="va">train_dat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">z_out</span> <span class="op">&lt;-</span> <span class="fu">Zresidual.coxph.frailty</span><span class="op">(</span><span class="va">fit_frail_cv</span>,</span></span>
<span class="r-in"><span>                                   traindata <span class="op">=</span> <span class="va">train_dat</span>,</span></span>
<span class="r-in"><span>                                   newdata   <span class="op">=</span> <span class="va">test_dat</span>,</span></span>
<span class="r-in"><span>                                   n.rep     <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Hettiarachchige Alias Egodage Dananji, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

