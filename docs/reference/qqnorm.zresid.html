<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Normal Q-Q Plot for Z-Residuals with Outlier Detection and Normality Diagnostics — qqnorm.zresid • Zresidual</title><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Normal Q-Q Plot for Z-Residuals with Outlier Detection and Normality Diagnostics — qqnorm.zresid"><meta name="description" content="Produces a normal Q-Q plot for Z-residuals, with optional
Shapiro–Wilk normality testing, automatic handling of infinite and extreme values,
axis breaks for very large residuals, and visual annotation of detected outliers.
This diagnostic is designed for checking the normality assumption of Z-residuals
obtained from Bayesian predictive model checks (posterior, LOOCV, ISCV, etc.)."><meta property="og:description" content="Produces a normal Q-Q plot for Z-residuals, with optional
Shapiro–Wilk normality testing, automatic handling of infinite and extreme values,
axis breaks for very large residuals, and visual annotation of detected outliers.
This diagnostic is designed for checking the normality assumption of Z-residuals
obtained from Bayesian predictive model checks (posterior, LOOCV, ISCV, etc.)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Zresidual</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/tiw150/Zresidual" aria-label="GitHub repository"><span class="fa fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../changelog.html" aria-label="Changelog"><span class="fa fas fa-newspaper"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Normal Q-Q Plot for Z-Residuals with Outlier Detection and Normality Diagnostics</h1>
      <small class="dont-index">Source: <a href="https://github.com/tiw150/Zresidual/blob/HEAD/R/qqnorm.zresid.R" class="external-link"><code>R/qqnorm.zresid.R</code></a></small>
      <div class="d-none name"><code>qqnorm.zresid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produces a normal Q-Q plot for Z-residuals, with optional
Shapiro–Wilk normality testing, automatic handling of infinite and extreme values,
axis breaks for very large residuals, and visual annotation of detected outliers.
This diagnostic is designed for checking the normality assumption of Z-residuals
obtained from Bayesian predictive model checks (posterior, LOOCV, ISCV, etc.).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'zresid'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  irep <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  diagnosis.test <span class="op">=</span> <span class="st">"SW"</span>,</span>
<span>  main.title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Normal Q-Q Plot"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Normal Q-Q Plot -"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Sample Quantiles"</span>,</span>
<span>  outlier.return <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  outlier.value <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span>  outlier.set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  my.mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span>,</span>
<span>  legend.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric matrix of Z-residuals where each column corresponds
to an iteration or predictive draw. The function also uses the attribute
<code>"type"</code> (optional model name) to construct default titles.</p></dd>


<dt id="arg-irep">irep<a class="anchor" aria-label="anchor" href="#arg-irep"></a></dt>
<dd><p>Integer or vector of integers indicating which column(s) of
<code>Zresidual</code> to plot. Defaults to <code>1</code>.</p></dd>


<dt id="arg-diagnosis-test">diagnosis.test<a class="anchor" aria-label="anchor" href="#arg-diagnosis-test"></a></dt>
<dd><p>Character string indicating the normality test to perform.
Currently only <code>"SW"</code> (Shapiro–Wilk test; using <code><a href="sw.test.zresid.html">sw.test.zresid()</a></code>)
is supported.</p></dd>


<dt id="arg-main-title">main.title<a class="anchor" aria-label="anchor" href="#arg-main-title"></a></dt>
<dd><p>Main title of the plot. If missing, it is automatically
constructed using the <code>"type"</code> attribute of <code>Zresidual</code>.</p></dd>


<dt id="arg-xlab-ylab">xlab, ylab<a class="anchor" aria-label="anchor" href="#arg-xlab-ylab"></a></dt>
<dd><p>Axis labels for the Q-Q plot.</p></dd>


<dt id="arg-outlier-return">outlier.return<a class="anchor" aria-label="anchor" href="#arg-outlier-return"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, the function prints and returns
the indices of detected outliers.</p></dd>


<dt id="arg-outlier-value">outlier.value<a class="anchor" aria-label="anchor" href="#arg-outlier-value"></a></dt>
<dd><p>Numeric threshold used to classify an observation as
an outlier based on <code>|Zresidual| &gt; outlier.value</code>. Default is <code>3.5</code>.</p></dd>


<dt id="arg-outlier-set">outlier.set<a class="anchor" aria-label="anchor" href="#arg-outlier-set"></a></dt>
<dd><p>Optional named list of graphical parameters passed to
<code><a href="https://rdrr.io/r/graphics/symbols.html" class="external-link">symbols</a></code> and <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></code> for customizing
the outlier annotation.</p></dd>


<dt id="arg-my-mar">my.mar<a class="anchor" aria-label="anchor" href="#arg-my-mar"></a></dt>
<dd><p>Numeric vector giving margin sizes, passed internally to
<code>par(mar = ...)</code>. Default is <code>c(5, 4, 4, 6) + 0.1</code>.</p></dd>


<dt id="arg-legend-settings">legend.settings<a class="anchor" aria-label="anchor" href="#arg-legend-settings"></a></dt>
<dd><p>Optional named list of parameters to override default
legend appearance settings.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional graphical arguments passed to <code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></code>
and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly returns a list with:</p><dl><dt>outliers</dt>
<dd><p>An integer vector containing the indices of detected outliers.</p></dd>


</dl><p>If no outliers are detected, an empty integer vector is returned.</p>
<p>A Q-Q plot is produced as a side effect.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function extends the base R Q-Q plot to better handle typical behavior
of Z-residuals in Bayesian predictive checking:</p>
<ul><li><p>Infinite values (<code>Inf</code>/<code>-Inf</code>) are replaced with large finite
values and trigger a warning.</p></li>
<li><p>Very large Z-residuals (<code>|Z| &gt; 6</code>) are shown using axis breaks to
avoid plot distortion.</p></li>
<li><p>Outliers (<code>|Z| &gt; outlier.value</code>) are highlighted and labeled.</p></li>
<li><p>Column-wise Shapiro–Wilk tests assess normality.</p></li>
<li><p>Legends summarize model type, selected Q-Q lines, and diagnostic results.</p></li>
</ul><p>This diagnostic is suitable for Z-residuals such as randomized quantile
residuals, posterior predictive Z-residuals, LOOCV/ISCV Z-residuals, and
residuals from hurdle or zero-inflated Bayesian models.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Dunn, P. K., &amp; Smyth, G. K. (1996). Randomized quantile residuals.
<em>Journal of Computational and Graphical Statistics</em>, 5(3), 236–244.</p>
<p>Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B.,
Vehtari, A., &amp; Rubin, D. B. (2013).
<em>Bayesian Data Analysis</em>. CRC Press.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="boxplot.zresid.html">boxplot.zresid</a></code>,
<code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></code>,
<code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></code>,
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tiw150.github.io/Zresidual">Zresidual</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Z</span>, <span class="st">"type"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Example Model"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic Q-Q plot</span></span></span>
<span class="r-in"><span><span class="fu">qqnorm.zresid</span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="qqnorm.zresid-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use the second column with custom outlier threshold</span></span></span>
<span class="r-in"><span><span class="fu">qqnorm.zresid</span><span class="op">(</span><span class="va">Z</span>, irep <span class="op">=</span> <span class="fl">2</span>, outlier.value <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="qqnorm.zresid-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Modify legend settings</span></span></span>
<span class="r-in"><span><span class="fu">qqnorm.zresid</span><span class="op">(</span><span class="va">Z</span>, legend.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="qqnorm.zresid-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tingxuan Wu, Longhai Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

