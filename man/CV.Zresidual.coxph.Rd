% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CV.Zresidual.coxph.survival.R
\name{CV.Zresidual.coxph}
\alias{CV.Zresidual.coxph}
\title{Cross-validated Z-residuals for Cox proportional hazards models}
\usage{
\method{CV.Zresidual}{coxph}(object, nfolds, foldlist = NULL, data = NULL, nrep = 1, ...)
}
\arguments{
\item{object}{A fitted \code{survival::coxph} model object.}

\item{nfolds}{Integer. The number of folds for cross-validation (K in K-fold CV).}

\item{foldlist}{Optional list specifying custom fold assignments. If
\code{NULL}, folds are generated internally, often ensuring a balanced
distribution of events.}

\item{data}{Optional data frame used to refit the model during
cross-validation. It is required if the original model call did not contain
the data explicitly, or when \code{foldlist} is supplied.}

\item{nrep}{Integer. Number of repeated cross-validations to perform.
Default is 1. Repeating CV provides a more stable estimate of the residuals.}

\item{...}{Further arguments passed to the internal worker functions.}
}
\value{
A matrix of class \code{"cvzresid"} (and others inherited from the internal
worker) with dimension \eqn{N \times nrep}{N x nrep}
(where \eqn{N}{N} is the number of observations).
The matrix columns contain the cross-validated Z-residuals.

The object also includes the following diagnostic attributes:
\itemize{
\item \code{Survival.Prob}: Cross-validated predicted survival probabilities
\eqn{\hat S_i(t_i)}{S_hat_i(t_i)}.
\item \code{linear.pred}: Cross-validated linear predictors
\eqn{\eta_i = \mathbf{x}_i^\top \hat{\boldsymbol{\beta}}}{eta_i = x_i^T beta_hat}.
\item \code{censored.status}: The event indicator from the survival object.
\item \code{covariates}: The covariates used in the model.
\item \code{object.model.frame}: The model frame of the original data.
}
}
\description{
S3 method for the generic function \code{CV.Zresidual()} applied to
Cox proportional hazards models fitted with \code{survival::coxph()}.
This method computes the cross-validated Z-residuals, automatically detecting
whether a frailty term is present in the model formula. It then dispatches
to the appropriate internal implementation for standard Cox models or shared
frailty Cox models.
}
\details{
The method determines the correct worker function by examining
\code{attr(object$terms, "specials")$frailty}:
\itemize{
\item \strong{Standard Cox Models}: If no frailty term is found, it calls
\code{\link{CV_Zresidual_coxph_survival}}.
\item \strong{Shared Frailty Cox Models}: If a frailty term (e.g., \code{frailty(group)})
is present, it calls \code{\link{CV_Zresidual_coxph_frailty_survival}}.
}

The returned object is a matrix of Z-residuals with crucial diagnostic
information stored as attributes.
}
\examples{
\dontrun{
  library(survival)
  # Example 1: Standard Cox Model
  fit_std <- coxph(Surv(time, status) ~ age + sex, data = lung)
  cv_out_std <- CV.Zresidual(fit_std, nfolds = 5, data = lung)

  # Example 2: Shared Frailty Cox Model (assuming the lung data has a group column 'inst')
  # lung$inst_factor <- as.factor(lung$inst)
  # fit_frty <- coxph(Surv(time, status) ~ age + sex + frailty(inst_factor), data = lung)
  # cv_out_frty <- CV.Zresidual(fit_frty, nfolds = 5, data = lung)
}

}
\seealso{
\code{\link[survival]{coxph}}, \code{\link{CV_Zresidual_coxph_survival}},
\code{\link{CV_Zresidual_coxph_frailty_survival}},
and the generic \code{\link{CV.Zresidual}}.
}
