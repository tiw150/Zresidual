% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CV.Zresidual.coxph.R
\name{CV.Zresidual.coxph}
\alias{CV.Zresidual.coxph}
\title{Cross-Validated Z-Residuals for Cox Proportional Hazards Models}
\usage{
CV.Zresidual.coxph(fit.coxph, data, nfolds, foldlist, n.rep)
}
\arguments{
\item{fit.coxph}{A fitted Cox proportional hazards model from
\pkg{survival}, created using `coxph()`.}

\item{data}{Optional data frame used for cross-validation.
If `NULL`, the model frame of `fit.coxph` is used internally.}

\item{nfolds}{Integer. Number of cross-validation folds.
If `NULL`, a default number of folds is chosen heuristically
based on the number of available cores (typically around 10 folds).}

\item{foldlist}{Optional list specifying fold indices.
If `NULL`, folds are created using `make_fold()`, stratifying by
survival time and censoring status.}

\item{n.rep}{Integer. Number of repeated Z-residual samples per observation.}
}
\value{
A numeric matrix of dimension \eqn{n \times} \code{n.rep}, where
\eqn{n} is the number of rows in \code{data} (if supplied) or in the
internal model frame of \code{fit.coxph}. Columns are named
`"CV.Z-residual 1"`, `"CV.Z-residual 2"`, …, up to \code{n.rep}.
The matrix has the following attributes:

* `type`: character string `"survival"`.
* `Survival.Prob`: numeric vector of predicted survival probabilities
  at the observed time for each observation.
* `linear.pred`: numeric vector of Cox linear predictors.
* `censored.status`: event indicator (1 = event, 0 = censored).
* `covariates`: data frame of covariates used in the residual computation.
* `object.model.frame`: data frame representing the model frame
  underlying the CV residuals.
}
\description{
Computes cross-validated (CV) Z-residuals for a Cox proportional hazards
model (`coxph`), optionally including user-supplied data or performing
CV using the model's internal model frame. The function performs
K-fold cross-validation, fits the Cox model on each training subset, and
computes Z-residuals on the held-out fold.
}
\details{
The function:

1. Extracts covariates and event information from either `data` or
   the model frame of `fit.coxph`.
2. Creates or uses supplied folds.
3. For each fold:
   - Fits the Cox model to the training subset.
   - Computes Z-residuals on the held-out subset using
     `Zresidual.coxph()`.
   - Handles failed model fits by filling the fold with `NA`.
4. Combines results into a matrix of dimension
   *n × n.rep*, where *n* is the number of observations.
}
\examples{
\dontrun{
  library(survival)
  fit <- coxph(Surv(time, status) ~ age + sex, data = lung)

  # 5-fold CV Z-residuals
  cvz <- CV.Zresidual.coxph(fit, data = lung, nfolds = 5, n.rep = 10)
}

}
\seealso{
`coxph()`,
`Zresidual.coxph()`,
`make_fold()`,
`CV.Zresidual()`
}
