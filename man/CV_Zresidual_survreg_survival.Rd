% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CV.Zresidual.survreg.survival.R
\name{CV_Zresidual_survreg_survival}
\alias{CV_Zresidual_survreg_survival}
\title{Cross-validated Z-residuals for parametric survival regression models
(internal worker)}
\usage{
CV_Zresidual_survreg_survival(fit.survreg, data, nfolds, foldlist, n.rep, ...)
}
\arguments{
\item{fit.survreg}{A fitted parametric survival regression model from
\pkg{survival}, created using \code{\link[survival]{survreg}}.}

\item{data}{Optional \code{data.frame} used for cross-validation. It must
contain the survival response and all covariates appearing in
\code{fit.survreg$terms}. If \code{NULL}, the model frame of
\code{fit.survreg} (via \code{model.frame.survreg()}) is used internally.}

\item{nfolds}{Integer. Number of cross-validation folds. If \code{NULL},
the number of folds is chosen heuristically by the caller (e.g. the
S3 method \code{CV.Zresidual.survreg()}).}

\item{foldlist}{Optional list specifying fold indices. Each element should
be an integer vector giving the row indices of the held-out (test) set
for a given fold. If \code{NULL}, folds are created using
\code{make_fold()}, stratifying by the survival response and censoring
indicator.}

\item{n.rep}{Integer. Number of repeated Z-residual samples per observation
in each fold (i.e. number of Monte Carlo replications for censored
observations in \code{Zresidual_survreg_survival()}).}

\item{...}{Further arguments passed to the internal worker function.}
}
\value{
A numeric matrix of dimension \eqn{n \times} \code{n.rep}, where \eqn{n}
is the number of rows in \code{data} (if supplied) or in the internal
model frame of \code{fit.survreg}. Columns are typically named
\code{"CV.Z-residual 1"}, \code{"CV.Z-residual 2"}, ..., up to
\code{n.rep}. The matrix usually carries attributes such as:
\itemize{
  \item \code{"type"}: character string \code{"survival"}.
  \item \code{"Survival.Prob"}: vector of predicted survival probabilities
        at the observed time for each observation.
  \item \code{"linear.pred"}: vector of linear predictors on the
        \code{survreg} scale.
  \item \code{"censored.status"}: event indicator (1 = event, 0 = censored).
  \item \code{"covariates"}: data frame of covariates used for the
        residual computation.
  \item \code{"object.model.frame"}: data frame representing the model
        frame underlying the CV residuals.
}
}
\description{
`CV_Zresidual_survreg_survival()` is the internal workhorse used by
[CV.Zresidual.survreg()] to compute cross-validated (CV) Z-residuals
for parametric survival regression models fitted by
\code{\link[survival]{survreg}}.

It performs K-fold cross-validation, refits the \code{survreg} model on
each training subset, and computes Z-residuals on the held-out fold via
\code{Zresidual_survreg_survival()}.
}
\details{
The function works in two modes:
\itemize{
  \item If \code{data} is not \code{NULL}, folds are defined on the rows
        of \code{data}. For each fold, the model is refitted on
        \code{data[-test, ]} and Z-residuals are computed on
        \code{data[test, ]}.
  \item If \code{data} is \code{NULL}, the internal model frame of
        \code{fit.survreg} is used. The function reconstructs explicit
        time and status columns from the \code{Surv} response before
        refitting the \code{survreg} model within each fold.
}

For each fold, `CV_Zresidual_survreg_survival()` attempts to refit the model
using the same formula and distribution as in \code{fit.survreg}. If the
model fit fails (due to convergence or other errors/warnings), the
corresponding fold residuals are filled with \code{NA}.

The per-fold Z-residual matrices are then stacked into a single
\eqn{n \times} \code{n.rep} matrix, where \eqn{n} is the total number of
observations. Attributes such as survival probabilities, linear predictors,
censoring status, covariates, and the model frame are reassembled in the
original observation order.
}
\examples{
\dontrun{
  library(survival)

  data(lung)
  fit_wb <- survreg(Surv(time, status) ~ age + sex,
                    data = lung, dist = "weibull")

  cvz_wb <- CV_Zresidual_survreg_survival(
    fit.survreg = fit_wb,
    data        = lung,
    nfolds      = 5,
    foldlist    = NULL,
    n.rep       = 10
  )
}

}
\seealso{
\code{\link[survival]{survreg}},
\code{Zresidual_survreg_survival()},
\code{CV.Zresidual.survreg()},
\code{make_fold()}
}
\keyword{internal}
