% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Zresidual.negbinomial.brms.R
\name{Zresidual_negbinomial_brms}
\alias{Zresidual_negbinomial_brms}
\title{Compute Z-residuals for negative binomial brms models}
\usage{
Zresidual_negbinomial_brms(fit, method = "iscv", n.rep = 1, ...)
}
\arguments{
\item{fit}{A fitted \pkg{brms} model object for a negative binomial
outcome.}

\item{method}{Character string specifying the residual calculation method:
\code{"iscv"} for importance-sampled cross-validated randomized predictive
p-values, \code{"rpost"} for posterior predictive p-values, or
\code{"mpost"} for marginal posterior predictive p-values. Default is
\code{"iscv"}.}

\item{n.rep}{Integer; the number of replicated Z-residual sets to generate.
Default is 1.}

\item{...}{Further arguments passed to lower-level helper functions.}
}
\value{
A numeric matrix of Z-residuals with attributes such as:
\itemize{
  \item \code{zero_id}: Indices of zero outcomes.
  \item \code{log_pmf}: Log-probability mass function values.
  \item \code{log_cdf}: Log-cumulative distribution function values.
  \item \code{covariates}: Model covariates.
  \item \code{linear.pred}: Linear predictor values from the fitted model.
}
The S3 wrapper [Zresidual.negbinomial.brms()] will additionally attach
the class \code{"zresid"} to the returned object.
}
\description{
Computes Z-residuals for fitted Bayesian negative binomial models.
Z-residuals are useful for model diagnostics, including checking fit and
overdispersion, and can be calculated using posterior or cross-validated
predictive p-values.

This is an internal workhorse for [Zresidual.negbinomial.brms()] and
is not intended to be called directly by end users.
}
\details{
The function typically performs the following steps:
\enumerate{
  \item Extracts the observed response vector from the model data.
  \item Computes the log-PMF and log-CDF for the negative binomial model
        using \code{\link{log_pred_dist_NB}}.
  \item Generates randomized or posterior predictive p-values according to the
        specified \code{method}.
  \item Converts the p-values to Z-residuals via the negative quantile of the
        standard normal distribution.
}

The output is a matrix of Z-residuals with one column per replication.
}
\examples{
\dontrun{
  # Compute Z-residuals for a negative binomial model
  zres_nb <- Zresidual_negbinomial_brms(
    fit    = fit_nb,
    method = "iscv"
  )

  # Compute Z-residuals with 2 replicates using posterior predictive p-values
  zres_nb_post <- Zresidual_negbinomial_brms(
    fit    = fit_nb,
    method = "rpost",
    n.rep  = 2
  )
}

}
\seealso{
\code{\link{log_pred_dist_NB}}, \code{\link{post_logrpp}},
\code{\link{iscv_logrpp}}, and the S3 wrapper
[Zresidual.negbinomial.brms()].
}
\keyword{internal}
