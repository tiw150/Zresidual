% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Zresidual.coxph.survival.R
\name{Zresidual.coxph.survival}
\alias{Zresidual.coxph.survival}
\title{Z-residuals for Cox proportional hazards models (survival package)}
\usage{
\method{Zresidual}{coxph.survival}(object, nrep = 1, data = NULL, type = "survival", method = NULL, ...)
}
\arguments{
\item{object}{A fitted \code{\link[survival]{coxph}} model. Supports
both standard Cox models and shared frailty models.}

\item{nrep}{Integer; number of independent randomized Z-residual
replicates to generate. Defaults to \code{1}.}

\item{data}{Optional \code{data.frame} containing the survival response
and covariates. When \code{NULL} (default), the residuals are computed
on the data used to fit the \code{object}. This parameter is often aliased
as \code{newdata} in the internal worker functions.}

\item{type}{Optional character string controlling the residual type.
Set internally to \code{"survival"} for Cox models.}

\item{method}{Character string specifying the residual calculation method.
Currently unused.}

\item{...}{Further arguments passed to the underlying implementation
functions.}
}
\value{
A numeric matrix of class \code{"zresid"} with dimension \eqn{N \times nrep}{N x nrep}.
Each column is an independent set of Z-residuals. The following diagnostic
attributes are attached:
\itemize{
\item \code{Survival.Prob}: Vector of predicted survival probabilities \eqn{S_i(t_i)}{S\_i(t\_i)}.
\item \code{linear.pred}: Vector of linear predictors \eqn{\eta_i = \mathbf{x}_i \mathbf{\hat{\beta}}}{eta\_i = x\_i * beta-hat}.
\item \code{covariates}: Data frame of covariates used in the model.
\item \code{censored.status}: Event indicator (1 = event, 0 = censored).
\item \code{object.model.frame}: The \code{model.frame} used for computation.
\item \code{type}: Character string, always \code{"survival"}.
}
}
\description{
\code{Zresidual.coxph.survival()} computes randomized Z-residuals for Cox
proportional hazards models fitted with \code{\link[survival]{coxph}},
supporting both standard and shared frailty models. This S3 method is
designed to be called via the generic function \code{\link{Zresidual}}.

The function automatically detects the presence of a frailty term (e.g.,
\code{frailty(group)}) and dispatches the calculation to one of two
internal implementations. These residuals are intended for \strong{in-sample}
diagnostics and model assessment.
}
\details{
This method dispatches work based on the model formula:

\itemize{
\item \strong{Standard Cox models (No Frailty)}:

The function calls \code{\link{Zresidual_coxph_survival}} to compute
Z-residuals using the fixed effects (\eqn{\mathbf{x}\hat{\mathbf{\beta}}}{x * beta-hat}) and the
estimated baseline cumulative hazard function \eqn{\hat{H}_0(t)}{H\_0\_hat(t)}.

\item \strong{Shared Frailty Cox models}:

The function calls \code{\link{Zresidual_coxph_frailty_survival}}. This
implementation computes residuals accounting for the cluster-level frailty
effect (\eqn{\hat{z}_{\text{group}}}{z\_group\_hat}). It requires the data used for fitting
(\code{traindata}) to reconstruct the baseline hazard and estimate the
frailty term.
}

\strong{Randomization for Censored Observations:}
Since the true survival probability for a censored observation $i$ is known
only to be greater than \eqn{S_i(t_i)}{S\_i(t\_i)}, the Z-residual uses a randomized survival
probability: \eqn{S_{i, \text{rand}}(t_i) = S_i(t_i) \cdot U}{S\_i\_rand(t\_i) = S\_i(t\_i) \* U}, where \eqn{U \sim \text{Unif}(0, 1)}{U \~ Unif(0, 1)}.
This randomization is repeated \code{nrep} times.
}
\examples{
\dontrun{
  library(survival)

  ## Standard Cox model (no frailty term)
  fit_cox <- coxph(Surv(time, status) ~ age + sex, data = lung)
  # Note: The internal class 'coxph.survival' is usually added by a wrapper,
  # but Zresidual() handles dispatch automatically.
  z_cox <- Zresidual(fit_cox, nrep = 10, data = lung)

  ## Shared frailty Cox model (in-sample residuals)
  # Note: 'inst' must be a grouping factor.
  lung$inst_f <- factor(lung$inst)
  fit_frail <- coxph(Surv(time, status) ~ age + sex + frailty(inst_f),
                     data = lung)
  z_in <- Zresidual(fit_frail, nrep = 5)
}

}
\seealso{
\code{\link{Zresidual}},
\code{\link{Zresidual_coxph_survival}},
\code{\link{Zresidual_coxph_frailty_survival}}
}
