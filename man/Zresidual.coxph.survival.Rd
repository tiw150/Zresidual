% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Zresidual.coxph.survival.R
\name{Zresidual.coxph.survival}
\alias{Zresidual.coxph.survival}
\title{Z-residuals for Cox proportional hazards models (survival package)}
\usage{
\method{Zresidual}{coxph.survival}(object, nrep = 1, data = NULL, type = NULL, method = NULL, ...)
}
\arguments{
\item{object}{A fitted [survival::coxph()] model. The function supports
both standard Cox models and shared frailty Cox models specified with
a term such as \code{frailty(group)} in the formula.}

\item{nrep}{Integer; number of independent randomized Z-residual
replicates to generate. Defaults to \code{1}. Each replicate corresponds
to a different randomization of censored observations.}

\item{data}{Optional \code{data.frame} containing the survival response
and covariates used in \code{object$terms}. When \code{NULL} (default),
the model frame is reconstructed from \code{object} and residuals are
computed on the original data.}

\item{type}{Optional character string controlling the residual type,
interpreted by the underlying implementation (if used). For Cox models,
this is typically set internally to \code{"survival"}.}

\item{method}{Character string specifying the residual calculation method
(if applicable to the underlying worker function). Currently unused
by the Cox PH implementation.}

\item{...}{Further arguments passed to the underlying implementation
functions. Currently unused.}
}
\value{
A numeric matrix of dimension \eqn{n \times} \code{nrep}, where \eqn{n} is
the number of observations in the data set on which residuals are
evaluated (either \code{data} if supplied, or the original model frame).
Each column corresponds to one set of Z-residuals. The returned matrix has
several attributes attached, including:
\itemize{
  \item \code{Survival.Prob}: vector of survival probabilities
    \eqn{S_i(t_i)} (or \eqn{S_{ij}(t_i)} in the frailty case).
  \item \code{linear.pred}: vector of linear predictors \eqn{\eta_i}
    (fixed effects; excluding the frailty term in shared frailty models).
  \item \code{covariates}: data frame of covariates (model frame without
    the survival response and grouping factor).
  \item \code{censored.status}: event indicator (1 = event, 0 = censored).
  \item \code{object.model.frame}: the \code{model.frame} used to compute
    the residuals.
  \item \code{type}: character string, typically \code{"survival"}.
}
}
\description{
`Zresidual.coxph.survival()` computes randomized Z-residuals for Cox
proportional hazards models fitted with [survival::coxph()], with or
without shared frailty terms. It is the S3 method for [Zresidual()]
when the fitted object is internally tagged with the class
`"coxph.survival"`, and is normally called via [Zresidual()] rather
than directly.

The function automatically detects whether the model formula contains
a frailty term (e.g. `frailty(group)`) and dispatches to separate
internal implementations for standard Cox models and shared frailty
Cox models. In both cases, Z-residuals are computed for a single
data set (typically the data used to fit the model) and are intended
for in-sample diagnostics.
}
\details{
There are two main usage patterns:

\itemize{
  \item \strong{Standard Cox models (no frailty term)}:

  When the model formula does not contain a frailty term, the method
  computes Z-residuals for a fitted `coxph` object using the survival
  response and covariates in \code{data}. If \code{data} is \code{NULL},
  the model frame is reconstructed from the fitted object and residuals
  are computed on the original data used to fit the model.

  Internally, this branch delegates to an implementation function such
  as \code{Zresidual_coxph_survival()}.

  \item \strong{Shared frailty Cox models}:

  If the model includes a multiplicative frailty term (e.g.
  \code{frailty(group)}), the method computes randomized Z-residuals
  that account for the cluster-level frailty. The same data set
  (either \code{data} if supplied, or the original model frame) is used
  both to reconstruct the baseline hazard / frailty effects and to
  evaluate residuals.

  Internally, this branch calls a dedicated frailty implementation,
  such as \code{Zresidual_coxph_frailty_survival()}.
}
}
\examples{
\dontrun{
  library(survival)

  ## Standard Cox model (no frailty term)
  fit_cox <- coxph(Surv(time, status) ~ age + sex, data = lung)
  z_cox <- Zresidual(fit_cox, nrep = 10, data = lung)

  ## Shared frailty Cox model (in-sample residuals)
  lung$inst <- factor(lung$inst)
  fit_frail <- coxph(Surv(time, status) ~ age + sex + frailty(inst),
                     data = lung)
  z_in <- Zresidual(fit_frail, nrep = 5)
}

}
\seealso{
Zresidual(),
Zresidual_coxph_survival(),
Zresidual_coxph_frailty_survival()
}
